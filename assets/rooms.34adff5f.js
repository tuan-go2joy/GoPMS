var co=Object.defineProperty,po=Object.defineProperties;var _o=Object.getOwnPropertyDescriptors;var w=Object.getOwnPropertySymbols;var B=Object.prototype.hasOwnProperty,N=Object.prototype.propertyIsEnumerable;var P=(o,e,r)=>e in o?co(o,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[e]=r,p=(o,e)=>{for(var r in e||(e={}))B.call(e,r)&&P(o,r,e[r]);if(w)for(var r of w(e))N.call(e,r)&&P(o,r,e[r]);return o},_=(o,e)=>po(o,_o(e));var Y=(o,e)=>{var r={};for(var a in o)B.call(o,a)&&e.indexOf(a)<0&&(r[a]=o[a]);if(o!=null&&w)for(var a of w(o))e.indexOf(a)<0&&N.call(o,a)&&(r[a]=o[a]);return r};import{Q as $,a as fo}from"./QCard.b9f01302.js";import{Q as yo}from"./QDialog.dde3e87a.js";import{au as A,aG as K,_ as vo,d as G,Z as H,aM as Z,k as z,p as b,aQ as Qo,o as S,a1 as J,a2 as I,u as l,c as q,F as Ro,a6 as Co,a as f,a0 as W,K as go,v as X,q as ho,a4 as D,a5 as Fo}from"./vendor.c8940223.js";import{d as k,e as oo}from"./axiosClient.fba0db00.js";import{Q as bo}from"./QSkeleton.657ae1f3.js";import{Q as So}from"./use-quasar.6c925fdd.js";import{Q as eo}from"./QSelect.9fdfa148.js";import{Q as Io}from"./QForm.0fcc3426.js";import{C as wo}from"./ClosePopup.e5424fb2.js";import{a as x,u as Oo}from"./useRoomTypesQuery.51027ea3.js";import{Q as R}from"./queryKeys.f0c0fd01.js";import{u as Mo,a as jo}from"./useRoomsQuery.57222687.js";import{_ as Vo}from"./plugin-vue_export-helper.21dcd24c.js";import"./index.93a91d69.js";import"./QMenu.2e2a6c56.js";const qo=async o=>{const{data:e}=await k.post("/rooms/create/",o);return e},ko=()=>{const o=K(),{findRoomTypeCodeById:e}=x(),r=t=>{const n=o.getQueryData(R.ROOMS),u=e(t.room_type);!n||!u||o.setQueryData(R.ROOMS,()=>n.map(s=>s.room_floor_id!==t.room_floor?s:_(p({},s),{list_rooms:[{id:t.id,name:t.name,room_type_code:u,room_type_id:t.id},...s.list_rooms]})))},a=t=>{const n=o.getQueryData(R.ROOM_TYPES);!n||o.setQueryData(R.ROOM_TYPES,()=>n.map(u=>u.id!==t.room_type?u:_(p({},u),{num_of_room:u.num_of_room+1})))};return A(qo,{onSuccess:t=>{a(t),r(t)}})},xo=async({queryKey:o})=>{const[,e]=o;if(!e)return;const{data:r}=await k.get(`/rooms/get/${e}`);return r},To=o=>{const e=[R.ROOMS,o];return vo(e,xo)},Eo=async r=>{var a=r,{room_id:o}=a,e=Y(a,["room_id"]);const{data:t}=await k.put(`/rooms/update/${o}`,p({},e));return t},Lo=()=>{const o=K(),{findRoomTypeCodeById:e}=x(),r=t=>{const n=o.getQueryData(R.ROOMS);if(!n)return;const u=n.flatMap(({list_rooms:y,room_floor_id:i,room_floor_name:C})=>y.map(O=>_(p({},O),{room_floor_id:i,room_floor_name:C}))).find(y=>y.id===t.id);if(!u)return;const s=e(t.room_type);if(!!s)return o.setQueryData(R.ROOMS,()=>{switch(u.room_floor_id!==t.room_floor){case!0:return n.map(i=>i.room_floor_id!==t.room_floor?_(p({},i),{list_rooms:i.list_rooms.filter(C=>C.id!==t.id)}):_(p({},i),{list_rooms:[...i.list_rooms,{id:t.id,name:t.name,room_type_code:s,room_type_id:t.room_type}]}));case!1:return n.map(i=>i.room_floor_id!==t.room_floor?i:_(p({},i),{list_rooms:i.list_rooms.map(C=>C.id!==t.id?C:{id:t.id,name:t.name,room_type_code:s,room_type_id:t.room_type})}))}}),u.room_type_code},a=(t,n)=>{const u=o.getQueryData(R.ROOM_TYPES);!u||!n||o.setQueryData(R.ROOM_TYPES,()=>u.map(s=>s.id===t.room_type?_(p({},s),{num_of_room:s.num_of_room+1}):s.code===n?_(p({},s),{num_of_room:s.num_of_room-1}):s))};return A(Eo,{onSuccess:t=>{const n=r(t);a(t,n)}})};const Uo={key:0,class:"wrapper"},Bo={key:1,class:"wrapper"},No={class:"q-mt-md row justify-end q-gutter-md"},Po=G({props:{roomId:null},setup(o){var U;const e=o,{notifySaveSuccess:r,notifySaveFailed:a}=Oo(),t=H(),n=Z(),{data:u,isLoading:s,findRoomTypeIdByCode:y}=x(),{data:i,isLoading:C}=Mo(),{findRoomByRoomId:O,isLoading:to}=jo(),{data:T,isLoading:ro}=To(e.roomId==="new"?0:e.roomId),so=ko(),ao=Lo(),E=z(()=>s.value||C.value||to.value||ro.value),no=Array.isArray(n.query.code)||(U=n.query.code)==null?void 0:U.replaceAll("_"," "),uo=y(no),v=b({name:""});Qo(()=>{var m,c,d,g,h,F;v.value={room_floor_id:(c=(m=T.value)==null?void 0:m.room_floor)!=null?c:t.options.history.state.floorId,room_type_id:(g=(d=T.value)==null?void 0:d.room_type)!=null?g:uo,name:e.roomId==="new"?"":(F=(h=O(e.roomId))==null?void 0:h.name)!=null?F:""}});const M=b(null),L=[m=>!!m||Q("this_field_is_required"),m=>Number.isInteger(m)||Q("this_is_invalid_value")],j=b(null),io=L,V=b(null),lo=[m=>!!m||Q("this_field_is_required"),m=>m.length<=50||Q("this_value_is_too_long")],{t:Q}=oo(),mo=()=>{var m,c,d,g,h,F;if((m=V.value)==null||m.validate(),(c=j.value)==null||c.validate(),(d=M.value)==null||d.validate(),!(((g=V.value)==null?void 0:g.error)||((h=j.value)==null?void 0:h.error)||((F=M.value)==null?void 0:F.error))){if(e.roomId==="new"){so.mutate(v.value,{onSuccess:()=>{r()},onError:()=>{a()}});return}ao.mutate(_(p({},v.value),{room_id:e.roomId}),{onSuccess:()=>{r()},onError:()=>{a()}})}};return(m,c)=>(S(),J(Io,{onSubmit:mo},{default:I(()=>[l(E)?(S(),q("div",Uo,[(S(),q(Ro,null,Co(3,d=>f(bo,{key:d,type:"QInput"})),64))])):(S(),q("div",Bo,[f(So,{ref_key:"nameField",ref:V,modelValue:v.value.name,"onUpdate:modelValue":c[0]||(c[0]=d=>v.value.name=d),label:l(Q)("room_name"),rules:lo},null,8,["modelValue","label"]),f(eo,{ref_key:"roomTypeField",ref:j,modelValue:v.value.room_type_id,"onUpdate:modelValue":c[1]||(c[1]=d=>v.value.room_type_id=d),label:l(Q)("room_type"),rules:l(io),options:l(u),"map-options":"","option-label":"code","option-value":"id","emit-value":""},null,8,["modelValue","label","rules","options"]),f(eo,{ref_key:"roomFloorField",ref:M,modelValue:v.value.room_floor_id,"onUpdate:modelValue":c[2]||(c[2]=d=>v.value.room_floor_id=d),label:l(Q)("floor"),rules:L,options:l(i),"map-options":"","option-label":"name","option-value":"id","emit-value":""},null,8,["modelValue","label","options"])])),W("div",No,[go(f(X,{label:l(Q)("cancel"),flat:"",type:"button"},null,8,["label"]),[[wo]]),f(X,{label:l(Q)("save"),color:"orange-9",type:"submit",disable:l(E)},null,8,["label","disable"])])]),_:1}))}});var Yo=Vo(Po,[["__scopeId","data-v-60270564"]]);const $o={class:"text-h6"},ne=G({setup(o){const e=H(),r=Z(),{t:a}=oo(),t=b(!1),n=z(()=>{const{roomId:s}=r.params;return Array.isArray(s)?null:s==="new"?"new":typeof+s=="number"?+s:null});ho(()=>t.value=!0);const u=()=>{e.replace({path:"/settings/room-settings",query:r.query})};return(s,y)=>l(n)?(S(),J(yo,{key:0,modelValue:t.value,"onUpdate:modelValue":y[0]||(y[0]=i=>t.value=i),onHide:u},{default:I(()=>[f(fo,{style:{width:"500px","max-width":"80vw"}},{default:I(()=>[f($,null,{default:I(()=>[W("div",$o,D(l(n)==="new"?l(a)("new_room"):l(a)("edit_room"))+" "+D(l(e).options.history.state.roomName),1)]),_:1}),f($,{class:"q-pt-none"},{default:I(()=>[f(Yo,{"room-id":l(n)},null,8,["room-id"])]),_:1})]),_:1})]),_:1},8,["modelValue"])):Fo("",!0)}});export{ne as default};
