var Re=Object.defineProperty,Qe=Object.defineProperties;var Ve=Object.getOwnPropertyDescriptors;var te=Object.getOwnPropertySymbols;var Ne=Object.prototype.hasOwnProperty,Oe=Object.prototype.propertyIsEnumerable;var oe=(e,t,o)=>t in e?Re(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,T=(e,t)=>{for(var o in t||(t={}))Ne.call(t,o)&&oe(e,o,t[o]);if(te)for(var o of te(t))Oe.call(t,o)&&oe(e,o,t[o]);return e},ae=(e,t)=>Qe(e,Ve(t));import{Q as Me,a as z,c as R,b as le}from"./QMenu.23017405.js";import{m as he,n as q,l as $,p as P,s as Q,w as X,X as $e,W as De,z as Le,C as ge,aM as Be,aN as Ie,u,aO as J,aP as be,d as we,aQ as Se,o as h,a1 as E,a2 as d,aR as M,aS as N,y as D,a as c,M as A,x as ne,a4 as L,t as B,c as U,r as Te,aT as re,F as se,a5 as ie,h as ue,a6 as ce}from"./vendor.6afcc2f0.js";import{Q as Pe}from"./QList.e585812b.js";import{a as Z,Q as Ce}from"./axiosClient.264e3cda.js";import{T as ze}from"./TouchPan.879d8082.js";import{u as Ae,a as je,d as ke}from"./useI18n.cd288b87.js";import{u as qe}from"./useNotify.ae0ad5bc.js";import{r as j}from"./index.26763fe5.js";import{u as Ee}from"./useRoomTypeFloorInfoQuery.eae95df3.js";import{u as Ke}from"./useRoomTypeListQuery.f3301e23.js";import{Q as Ue}from"./QSeparator.16660505.js";import{Q as We}from"./QTable.db4622a1.js";import{C as de}from"./ClosePopup.49e1b2a3.js";import{Q as K}from"./queryKeys.553e4145.js";import"./use-prevent-scroll.3abd3655.js";import"./QSelect.4297c779.js";const Ye=["top","middle","bottom"];var me=he({name:"QBadge",props:{color:String,textColor:String,floating:Boolean,transparent:Boolean,multiLine:Boolean,outline:Boolean,rounded:Boolean,label:[Number,String],align:{type:String,validator:e=>Ye.includes(e)}},setup(e,{slots:t}){const o=q(()=>e.align!==void 0?{verticalAlign:e.align}:null),n=q(()=>{const l=e.outline===!0&&e.color||e.textColor;return`q-badge flex inline items-center no-wrap q-badge--${e.multiLine===!0?"multi":"single"}-line`+(e.outline===!0?" q-badge--outline":e.color!==void 0?` bg-${e.color}`:"")+(l!==void 0?` text-${l}`:"")+(e.floating===!0?" q-badge--floating":"")+(e.rounded===!0?" q-badge--rounded":"")+(e.transparent===!0?" q-badge--transparent":"")});return()=>$("div",{class:n.value,style:o.value,role:"alert","aria-label":e.label},e.label!==void 0?e.label:P(t.default))}}),Xe=he({name:"QSplitter",props:ae(T({},Ae),{modelValue:{type:Number,required:!0},reverse:Boolean,unit:{type:String,default:"%",validator:e=>["%","px"].includes(e)},limits:{type:Array,validator:e=>e.length!==2||typeof e[0]!="number"||typeof e[1]!="number"?!1:e[0]>=0&&e[0]<=e[1]},emitImmediately:Boolean,horizontal:Boolean,disable:Boolean,beforeClass:[Array,String,Object],afterClass:[Array,String,Object],separatorClass:[Array,String,Object],separatorStyle:[Array,String,Object]}),emits:["update:modelValue"],setup(e,{slots:t,emit:o}){const{proxy:{$q:n}}=Le(),l=je(e,n),r=Q(null),g={before:Q(null),after:Q(null)},_=q(()=>`q-splitter no-wrap ${e.horizontal===!0?"q-splitter--horizontal column":"q-splitter--vertical row"} q-splitter--${e.disable===!0?"disabled":"workable"}`+(l.value===!0?" q-splitter--dark":"")),p=q(()=>e.horizontal===!0?"height":"width"),y=q(()=>e.reverse!==!0?"before":"after"),m=q(()=>e.limits!==void 0?e.limits:e.unit==="%"?[10,90]:[50,1/0]);function S(a){return(e.unit==="%"?a:Math.round(a))+e.unit}const b=q(()=>({[y.value]:{[p.value]:S(e.modelValue)}}));let C,V,F,O,k;function f(a){if(a.isFirst===!0){const i=r.value.getBoundingClientRect()[p.value];C=e.horizontal===!0?"up":"left",V=e.unit==="%"?100:i,F=Math.min(V,m.value[1],Math.max(m.value[0],e.modelValue)),O=(e.reverse!==!0?1:-1)*(e.horizontal===!0?1:n.lang.rtl===!0?-1:1)*(e.unit==="%"?i===0?0:100/i:1),r.value.classList.add("q-splitter--active");return}if(a.isFinal===!0){k!==e.modelValue&&o("update:modelValue",k),r.value.classList.remove("q-splitter--active");return}const s=F+O*(a.direction===C?-1:1)*a.distance[e.horizontal===!0?"y":"x"];k=Math.min(V,m.value[1],Math.max(m.value[0],s)),g[y.value].value.style[p.value]=S(k),e.emitImmediately===!0&&e.modelValue!==k&&o("update:modelValue",k)}const v=q(()=>[[ze,f,void 0,{[e.horizontal===!0?"vertical":"horizontal"]:!0,prevent:!0,stop:!0,mouse:!0,mouseAllDir:!0}]]);function w(a,s){a<s[0]?o("update:modelValue",s[0]):a>s[1]&&o("update:modelValue",s[1])}return X(()=>e.modelValue,a=>{w(a,m.value)}),X(()=>e.limits,()=>{ge(()=>{w(e.modelValue,m.value)})}),()=>{const a=[$("div",{ref:g.before,class:["q-splitter__panel q-splitter__before"+(e.reverse===!0?" col":""),e.beforeClass],style:b.value.before},P(t.before)),$("div",{class:["q-splitter__separator",e.separatorClass],style:e.separatorStyle,"aria-disabled":e.disable===!0?"true":void 0},[$e("div",{class:"q-splitter__separator-area absolute-full"},P(t.separator),"sep",e.disable!==!0,()=>v.value)]),$("div",{ref:g.after,class:["q-splitter__panel q-splitter__after"+(e.reverse===!0?"":" col"),e.afterClass],style:b.value.after},P(t.after))];return $("div",{class:_.value,ref:r},De(t.default,a))}}});function Ge(e){return Be()?(Ie(e),!0):!1}const I=typeof window!="undefined",He=e=>typeof e=="string",W=()=>{};function Y(e){var t;const o=u(e);return(t=o==null?void 0:o.$el)!=null?t:o}const Fe=I?window:void 0;I&&window.document;I&&window.navigator;I&&window.location;function fe(...e){let t,o,n,l;if(He(e[0])?([o,n,l]=e,t=Fe):[t,o,n,l]=e,!t)return W;let r=W;const g=X(()=>u(t),p=>{r(),!!p&&(p.addEventListener(o,n,l),r=()=>{p.removeEventListener(o,n,l),r=W})},{immediate:!0,flush:"post"}),_=()=>{g(),r()};return Ge(_),_}function Je(e,t,o={}){const{window:n=Fe,ignore:l}=o;if(!n)return;const r=Q(!0),_=[fe(n,"click",y=>{const m=Y(e),S=y.composedPath();!m||m===y.target||S.includes(m)||!r.value||l&&l.length>0&&l.some(b=>{const C=Y(b);return C&&(y.target===C||S.includes(C))})||t(y)},{passive:!0,capture:!0}),fe(n,"pointerdown",y=>{const m=Y(e);r.value=!!m&&!y.composedPath().includes(m)},{passive:!0})];return()=>_.forEach(y=>y())}const G=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},H="__vueuse_ssr_handlers__";G[H]=G[H]||{};G[H];var ve,_e;I&&(window==null?void 0:window.navigator)&&((ve=window==null?void 0:window.navigator)==null?void 0:ve.platform)&&/iP(ad|hone|od)/.test((_e=window==null?void 0:window.navigator)==null?void 0:_e.platform);var Ze=Object.defineProperty,pe=Object.getOwnPropertySymbols,et=Object.prototype.hasOwnProperty,tt=Object.prototype.propertyIsEnumerable,ye=(e,t,o)=>t in e?Ze(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,ot=(e,t)=>{for(var o in t||(t={}))et.call(t,o)&&ye(e,o,t[o]);if(pe)for(var o of pe(t))tt.call(t,o)&&ye(e,o,t[o]);return e};const at={top:0,left:0,bottom:0,right:0,height:0,width:0};ot({text:""},at);const xe=e=>{const t=Q(!1),o=Q(null),n=async()=>{var r;t.value=!0,await ge(),(r=o.value)==null||r.focus()},l=()=>{t.value=!1,e==null||e.onFinishEdit()};return Je(o,()=>l()),{inputElementRef:o,isEditMode:t,startEdit:n,finishEdit:l}},lt=async e=>{const{data:t}=await Z.post("/configuration/room/createFloor",e);return t},nt=()=>J(lt,{onSuccess:()=>{}}),rt=async e=>{await Z.post("/configuration/room/deleteFloor",e)},st=()=>{const e=be();return J(rt,{onSuccess:(t,o)=>{const n=e.getQueryData(K.FLOORS);!n||e.setQueryData(K.FLOORS,()=>n.filter(l=>l.sn!==o.sn))}})},it=async e=>{const{data:t}=await Z.post("/configuration/room/updateFloor",e);return t},ut=()=>{const e=be();return J(it,{onSuccess:(t,o)=>{const n=e.getQueryData(K.FLOORS);!n||e.setQueryData(K.FLOORS,()=>n.map(l=>l.sn!==o.sn?l:T(T({},l),o)))}})},ct=we({props:{floorName:null,floorSn:null,rooms:null},setup(e){const t=e,{data:o}=Ee(),{notifySaveSuccess:n,notifySaveFailed:l,notifyWarning:r}=qe(),g=Se(),{t:_}=ke(),p=q(()=>{const{code:a}=g.query;return!a||Array.isArray(a)?t.rooms:t.rooms.filter(({roomTypeCode:s})=>s===a.replaceAll("_"," "))}),y=ut(),m=st(),S=Q(t.floorName),{inputElementRef:b,isEditMode:C,startEdit:V,finishEdit:F}=xe({onFinishEdit:()=>S.value=t.floorName}),O=[a=>!!a||_("this_is_invalid_value"),a=>a.length<=10||_("this_value_is_too_long"),a=>{var s,i;return!((i=(s=o.value)==null?void 0:s.data)==null?void 0:i.some(({name:x})=>x===a))||_("this_is_invalid_value")}],k=async a=>{var i,x;if((i=b.value)==null||i.validate(),(x=b.value)==null?void 0:x.error)return;const{value:s}=a.currentTarget;y.mutate({sn:t.floorSn,name:s},{onSuccess:()=>{n(),F()},onError:()=>{l()}})},f=()=>{if(t.rooms.length!==0){r(_("please_remove_all_rooms_of_this_floor"));return}m.mutate({sn:t.floorSn},{onSuccess:()=>{n()},onError:()=>{l()}})},v=(a,s)=>{j.replace({path:`/settings/room-settings/rooms/${s.sn}`,state:{roomName:s.name,floorId:t.floorSn},query:g.query})},w=()=>{j.replace({path:"/settings/room-settings/rooms/new",state:{roomName:null,floorId:t.floorSn},query:g.query})};return(a,s)=>(h(),E(We,{grid:"",title:t.floorName,rows:u(p),columns:[{name:"room_type_code",label:"Room Type Code",field:i=>i.room_type_code},{name:"name",label:"Room Name",field:i=>i.name}],"hide-pagination":"",onRowClick:v},{"top-left":d(()=>[u(C)?(h(),E(Ce,{key:0,ref_key:"inputElementRef",ref:b,modelValue:S.value,"onUpdate:modelValue":s[0]||(s[0]=i=>S.value=i),class:"text-h5",rules:O,placeholder:u(_)("input_floor_name"),filled:"",dense:"",onKeydown:[M(N(k,["prevent"]),["enter"]),M(N(u(F),["prevent"]),["esc"]),M(N(u(F),["prevent"]),["tab"])]},null,8,["modelValue","placeholder","onKeydown"])):(h(),E(D,{key:1,label:t.floorName,class:"text-h5",padding:"xs 12px","no-caps":"",dense:"",flat:"",onClick:u(V)},null,8,["label","onClick"]))]),"top-right":d(()=>[c(D,{flat:"",round:"",icon:"more_vert"},{default:d(()=>[c(Me,{anchor:"bottom right",self:"top right"},{default:d(()=>[A((h(),E(z,{clickable:"",onClick:w},{default:d(()=>[c(R,{side:""},{default:d(()=>[c(ne,{name:"add"})]),_:1}),c(R,null,{default:d(()=>[L(B(u(_)("add_new_room")),1)]),_:1})]),_:1})),[[de]]),c(Ue),A((h(),E(z,{clickable:"",onClick:f},{default:d(()=>[c(R,{side:""},{default:d(()=>[c(ne,{name:"delete"})]),_:1}),c(R,null,{default:d(()=>[L(B(u(_)("delete_floor")),1)]),_:1})]),_:1})),[[de]])]),_:1})]),_:1})]),_:1},8,["title","rows","columns"]))}}),dt={class:"row"},mt={class:"q-my-xl row justify-center"},Vt=we({setup(e){const{data:t}=Ke(),{data:o}=Ee(),n=nt(),l=Se(),{t:r}=ke(),{notifySaveSuccess:g,notifySaveFailed:_}=qe(),p=Q(""),y=[f=>!!f||r("this_is_invalid_value"),f=>f.length<=10||r("this_value_is_too_long"),f=>{var v,w;return!((w=(v=o.value)==null?void 0:v.data)==null?void 0:w.some(({name:a})=>a===f))||r("this_is_invalid_value")}],{inputElementRef:m,isEditMode:S,finishEdit:b,startEdit:C}=xe({onFinishEdit:()=>p.value=""}),V=q(()=>{var v,w;let f=0;return(w=(v=t.value)==null?void 0:v.data)==null||w.forEach(({numOfRoom:a})=>f+=a),f}),F=async()=>{var f,v;(f=m.value)==null||f.validate(),!((v=m.value)==null?void 0:v.error)&&n.mutate({name:p.value},{onSuccess:()=>{g(),b()},onError:()=>{_()}})},O=()=>{console.log("Create new room type"),j.replace({path:"/settings/room-settings/room-types/new",query:l.query,state:{code:null}})},k=(f,v)=>{console.log("Edit room type",f),j.replace({path:`/settings/room-settings/room-types/${f}`,query:l.query,state:{code:v}})};return(f,v)=>{const w=Te("router-view");return h(),U("div",null,[c(Xe,{"model-value":15,"before-class":"q-px-sm","separator-style":"background-color: transparent;"},{before:d(()=>[c(Pe,{separator:"",bordered:""},{default:d(()=>{var a;return[A((h(),E(z,{to:"/settings/room-settings",replace:""},{default:d(()=>[c(R,{class:re([u(l).query.code?"text-black":"text-primary"])},{default:d(()=>[L(B(u(r)("all")),1)]),_:1},8,["class"]),c(R,{side:""},{default:d(()=>[c(me,{label:u(V),rounded:""},null,8,["label"])]),_:1})]),_:1})),[[ce]]),(h(!0),U(se,null,ie((a=u(t))==null?void 0:a.data,({numOfRoom:s,code:i,name:x,sn:ee})=>A((h(),E(z,{key:ee,to:`/settings/room-settings?code=${i}`,replace:""},{default:d(()=>[c(R,null,{default:d(()=>[c(le,{class:re([u(l).query.code===i?"text-primary":"text-black"])},{default:d(()=>[L(B(i)+" ",1),c(me,{label:s,rounded:""},null,8,["label"])]),_:2},1032,["class"]),c(le,{caption:""},{default:d(()=>[L(B(x),1)]),_:2},1024)]),_:2},1024),c(R,{side:""},{default:d(()=>[c(D,{icon:"edit",flat:"",round:"",onClick:N(ft=>k(ee,i),["prevent"])},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["to"])),[[ce]])),128))]}),_:1}),ue("div",dt,[c(D,{label:u(r)("new_room_type"),class:"col q-my-md",icon:"add_circle",stretch:"",onClick:O},null,8,["label"])])]),after:d(()=>{var a;return[(h(!0),U(se,null,ie((a=u(o))==null?void 0:a.data,({name:s,sn:i,roomList:x})=>(h(),E(ct,{key:i,"floor-name":s,"floor-sn":i,rooms:x},null,8,["floor-name","floor-sn","rooms"]))),128)),ue("div",mt,[u(S)?(h(),E(Ce,{key:0,ref_key:"inputElementRef",ref:m,modelValue:p.value,"onUpdate:modelValue":v[0]||(v[0]=s=>p.value=s),rules:y,class:"h-sm",placeholder:u(r)("input_floor_name"),filled:"",onKeydown:[M(N(F,["prevent"]),["enter"]),M(N(u(b),["prevent"]),["esc"]),M(N(u(b),["prevent"]),["tab"])]},null,8,["modelValue","placeholder","onKeydown"])):(h(),E(D,{key:1,label:u(r)("new_floor"),icon:"add_circle",onClick:u(C)},null,8,["label","onClick"]))])]}),_:1}),c(w)])}}});export{Vt as default};
