var ie=Object.defineProperty,de=Object.defineProperties;var ce=Object.getOwnPropertyDescriptors;var O=Object.getOwnPropertySymbols;var L=Object.prototype.hasOwnProperty,$=Object.prototype.propertyIsEnumerable;var Y=(a,t,l)=>t in a?ie(a,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[t]=l,w=(a,t)=>{for(var l in t||(t={}))L.call(t,l)&&Y(a,l,t[l]);if(O)for(var l of O(t))$.call(t,l)&&Y(a,l,t[l]);return a},S=(a,t)=>de(a,ce(t));var A=(a,t)=>{var l={};for(var s in a)L.call(a,s)&&t.indexOf(s)<0&&(l[s]=a[s]);if(a!=null&&O)for(var s of O(a))t.indexOf(s)<0&&$.call(a,s)&&(l[s]=a[s]);return l};import{Q as D}from"./QCardSection.c854a72b.js";import{Q as me}from"./QCard.32dcd3f8.js";import{Q as y,a as _e}from"./queryKeys.97f4c9ca.js";import{aO as J,aP as W,ax as pe,d as X,n as Z,s as p,aU as ye,o as v,a1 as ee,a2 as C,u as i,c as I,F as K,a5 as j,a as m,h as M,M as ve,y as H,a3 as fe,aQ as be,v as he,t as z,i as Qe}from"./vendor.6afcc2f0.js";import{d as te}from"./useI18n.5362addb.js";import{Q as G}from"./QSkeleton.3106c07d.js";import{a as N,Q as V}from"./axiosClient.f33fe5d8.js";import{Q as ge}from"./QForm.59835bee.js";import{C as Re}from"./ClosePopup.f66efbcc.js";import{u as Te}from"./useNotify.80155021.js";import{u as Ve}from"./useRoomTypesQuery.54542a35.js";import{_ as Ce}from"./plugin-vue_export-helper.21dcd24c.js";import"./use-prevent-scroll.943a605d.js";const Fe=async a=>{const{data:t}=await N.post("/rooms/room_type/create/",a);return t},Oe=()=>{const a=W();return J(Fe,{onSuccess:t=>{const l=a.getQueryData(y.ROOM_TYPES);!l||a.setQueryData(y.ROOM_TYPES,()=>[{id:t.id,num_of_room:0,code:t.code,name:t.name},...l])}})},we=async({queryKey:a})=>{const[,t]=a;if(!t)return;const{data:l}=await N.get(`/rooms/room_type/get/${t}`);return l},Se=a=>{const t=[y.ROOM_TYPES,a];return pe(t,we)},Ie=async l=>{var s=l,{id:a}=s,t=A(s,["id"]);const{data:o}=await N.put(`/rooms/room_type/update/${a}`,t);return o},Me=()=>{const a=W(),t=s=>{const o=a.getQueryData(y.ROOM_TYPES);!o||a.setQueryData(y.ROOM_TYPES,()=>o.map(d=>d.id!==s.id?d:{id:s.id,num_of_room:d.num_of_room,name:s.name,code:s.code}))},l=s=>{const o=a.getQueryData(y.ROOMS);!o||a.setQueryData(y.ROOMS,()=>o.map(d=>{const f=d.list_rooms.map(n=>S(w({},n),{room_type_code:s.code}));return S(w({},d),{list_rooms:f})}))};return J(Ie,{onSuccess:s=>{t(s),l(s)}})};const ke={key:0,class:"wrapper"},qe={class:"container"},xe={key:1,class:"wrapper"},Ee={class:"container"},Ue={class:"q-mt-md row justify-end q-gutter-md"},Be=X({props:{roomTypeId:null},setup(a){const t=a,{notifySaveSuccess:l,notifySaveFailed:s}=Te(),{t:o}=te(),{data:d,isLoading:f}=Ve(),{data:n,isLoading:F}=Se(t.roomTypeId==="new"?0:+t.roomTypeId),k=Oe(),oe=Me(),P=Z(()=>f.value||F.value),c=p({capacity_adult:2,capacity_child:0,num_of_bed:1,name:"",code:""});ye(()=>{var e,u,r,_,b,h,Q,g,R,T;c.value={capacity_adult:(u=(e=n.value)==null?void 0:e.capacity_adult)!=null?u:2,capacity_child:(_=(r=n.value)==null?void 0:r.capacity_child)!=null?_:0,num_of_bed:(h=(b=n.value)==null?void 0:b.num_of_bed)!=null?h:1,name:(g=(Q=n.value)==null?void 0:Q.name)!=null?g:"",code:(T=(R=n.value)==null?void 0:R.code)!=null?T:""}});const q=p(null),ae=[e=>!!e||o("this_field_is_required"),e=>Number.isInteger(e)||o("this_is_invalid_value"),e=>1<=e||o("this_value_is_too_small"),e=>e<=10||o("this_value_is_too_big")],x=p(null),le=[e=>!!e||o("this_field_is_required"),e=>Number.isInteger(e)||o("this_is_invalid_value"),e=>0<=e||o("this_is_invalid_value"),e=>e<=10||o("this_value_is_too_big")],E=p(null),se=[e=>!!e||o("this_field_is_required"),e=>Number.isInteger(e)||o("this_is_invalid_value"),e=>1<=e||o("this_value_is_too_small"),e=>e<=10||o("this_value_is_too_big")],U=p(null),re=[e=>!!e||o("this_field_is_required"),e=>e.length<=50||o("this_value_is_too_long"),e=>{var u;return!((u=d.value)==null?void 0:u.filter(r=>{var _;return r.id!==((_=n.value)==null?void 0:_.id)}).some(r=>r.name===e))||o("this_is_invalid_value")}],B=p(null),ue=[e=>!!e||o("this_field_is_required"),e=>e.length<=10||o("this_value_is_too_long"),e=>{var u;return!((u=d.value)==null?void 0:u.filter(r=>{var _;return r.id!==((_=n.value)==null?void 0:_.id)}).some(r=>r.code===e))||o("this_is_invalid_value")}],ne=()=>{var e,u,r,_,b,h,Q,g,R,T;if((e=q.value)==null||e.validate(),(u=x.value)==null||u.validate(),(r=E.value)==null||r.validate(),(_=U.value)==null||_.validate(),(b=B.value)==null||b.validate(),!(((h=q.value)==null?void 0:h.error)||((Q=x.value)==null?void 0:Q.error)||((g=E.value)==null?void 0:g.error)||((R=U.value)==null?void 0:R.error)||((T=B.value)==null?void 0:T.error))){if(t.roomTypeId==="new"){k.mutate(c.value,{onSuccess:()=>{l()},onError:()=>{s()}});return}!n.value||oe.mutate(S(w({},c.value),{id:t.roomTypeId,is_active:n.value.is_active}),{onSuccess:()=>{l()},onError:()=>{s()}})}};return(e,u)=>(v(),ee(ge,{onSubmit:ne},{default:C(()=>[i(P)?(v(),I("div",ke,[(v(),I(K,null,j(2,r=>m(G,{key:r,type:"QInput"})),64)),M("div",qe,[(v(),I(K,null,j(3,r=>m(G,{key:r,class:"col",type:"QInput"})),64))])])):(v(),I("div",xe,[m(V,{ref_key:"codeField",ref:B,modelValue:c.value.code,"onUpdate:modelValue":u[0]||(u[0]=r=>c.value.code=r),label:i(o)("room_type_code"),rules:ue},null,8,["modelValue","label"]),m(V,{ref_key:"nameField",ref:U,modelValue:c.value.name,"onUpdate:modelValue":u[1]||(u[1]=r=>c.value.name=r),label:i(o)("room_type_name"),rules:re},null,8,["modelValue","label"]),M("div",Ee,[m(V,{ref_key:"numOfBedField",ref:E,modelValue:c.value.num_of_bed,"onUpdate:modelValue":u[2]||(u[2]=r=>c.value.num_of_bed=r),modelModifiers:{number:!0},label:i(o)("number_of_beds"),rules:se,class:"col",type:"number"},null,8,["modelValue","label"]),m(V,{ref_key:"capacityAdultField",ref:q,modelValue:c.value.capacity_adult,"onUpdate:modelValue":u[3]||(u[3]=r=>c.value.capacity_adult=r),modelModifiers:{number:!0},label:i(o)("number_of_adults"),rules:ae,class:"col",type:"number"},null,8,["modelValue","label"]),m(V,{ref_key:"capacityChildField",ref:x,modelValue:c.value.capacity_child,"onUpdate:modelValue":u[4]||(u[4]=r=>c.value.capacity_child=r),modelModifiers:{number:!0},label:i(o)("number_of_children"),rules:le,class:"col",type:"number"},null,8,["modelValue","label"])])])),M("div",Ue,[ve(m(H,{label:i(o)("cancel"),flat:"",type:"button"},null,8,["label"]),[[Re]]),m(H,{label:i(o)("save"),color:"orange-9",type:"submit",disable:i(P)},null,8,["label","disable"])])]),_:1}))}});var Ne=Ce(Be,[["__scopeId","data-v-cbb39d38"]]);const Pe={class:"text-h6"},et=X({setup(a){const t=fe(),l=be(),{t:s}=te(),o=p(!1),d=Z(()=>{const{roomTypeId:n}=l.params;return Array.isArray(n)?null:n==="new"?"new":typeof+n=="number"?+n:null});he(()=>o.value=!0);const f=()=>{t.replace({path:"/settings/room-settings",query:l.query})};return(n,F)=>i(d)?(v(),ee(_e,{key:0,modelValue:o.value,"onUpdate:modelValue":F[0]||(F[0]=k=>o.value=k),onHide:f},{default:C(()=>[m(me,{style:{width:"700px","max-width":"80vw"}},{default:C(()=>[m(D,null,{default:C(()=>[M("div",Pe,z(i(d)==="new"?i(s)("new_room_type"):i(s)("edit_room_type"))+" "+z(i(t).options.history.state.code),1)]),_:1}),m(D,{class:"q-pt-none"},{default:C(()=>[m(Ne,{"room-type-id":i(d)},null,8,["room-type-id"])]),_:1})]),_:1})]),_:1},8,["modelValue"])):Qe("",!0)}});export{et as default};
