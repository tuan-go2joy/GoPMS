var ie=Object.defineProperty,de=Object.defineProperties;var ce=Object.getOwnPropertyDescriptors;var F=Object.getOwnPropertySymbols;var $=Object.prototype.hasOwnProperty,L=Object.prototype.propertyIsEnumerable;var Y=(a,t,l)=>t in a?ie(a,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[t]=l,O=(a,t)=>{for(var l in t||(t={}))$.call(t,l)&&Y(a,l,t[l]);if(F)for(var l of F(t))L.call(t,l)&&Y(a,l,t[l]);return a},S=(a,t)=>de(a,ce(t));var A=(a,t)=>{var l={};for(var s in a)$.call(a,s)&&t.indexOf(s)<0&&(l[s]=a[s]);if(a!=null&&F)for(var s of F(a))t.indexOf(s)<0&&L.call(a,s)&&(l[s]=a[s]);return l};import{Q as D}from"./QCardSection.b278b73a.js";import{Q as me}from"./QCard.7c0ad1c3.js";import{Q as y,a as _e}from"./queryKeys.336f5b66.js";import{aN as G,aO as J,aw as pe,d as W,k as X,n as p,aT as ye,o as v,$ as ee,a0 as C,u as i,c as I,F as K,a4 as j,a as m,Z as M,I as ve,s as H,_ as fe,aP as be,p as he,a2 as Z,a3 as ge}from"./vendor.71878d25.js";import{d as te}from"./useI18n.26b256e3.js";import{Q as z}from"./QSkeleton.863a1ca4.js";import{a as U,Q as V}from"./axiosClient.da76d854.js";import{Q as Qe}from"./QForm.0f37de0d.js";import{C as Re}from"./ClosePopup.cdbaede7.js";import{u as Te}from"./useNotify.2ba89e99.js";import{u as Ve}from"./useRoomTypesQuery.2b2e1ed3.js";import{_ as Ce}from"./plugin-vue_export-helper.21dcd24c.js";import"./use-prevent-scroll.15991844.js";const we=async a=>{const{data:t}=await U.post("/rooms/room_type/create/",a);return t},Fe=()=>{const a=J();return G(we,{onSuccess:t=>{const l=a.getQueryData(y.ROOM_TYPES);!l||a.setQueryData(y.ROOM_TYPES,()=>[{id:t.id,num_of_room:0,code:t.code,name:t.name},...l])}})},Oe=async({queryKey:a})=>{const[,t]=a;if(!t)return;const{data:l}=await U.get(`/rooms/room_type/get/${t}`);return l},Se=a=>{const t=[y.ROOM_TYPES,a];return pe(t,Oe)},Ie=async l=>{var s=l,{id:a}=s,t=A(s,["id"]);const{data:o}=await U.put(`/rooms/room_type/update/${a}`,t);return o},Me=()=>{const a=J(),t=s=>{const o=a.getQueryData(y.ROOM_TYPES);!o||a.setQueryData(y.ROOM_TYPES,()=>o.map(d=>d.id!==s.id?d:{id:s.id,num_of_room:d.num_of_room,name:s.name,code:s.code}))},l=s=>{const o=a.getQueryData(y.ROOMS);!o||a.setQueryData(y.ROOMS,()=>o.map(d=>{const f=d.list_rooms.map(n=>S(O({},n),{room_type_code:s.code}));return S(O({},d),{list_rooms:f})}))};return G(Ie,{onSuccess:s=>{t(s),l(s)}})};const ke={key:0,class:"wrapper"},qe={class:"container"},Ee={key:1,class:"wrapper"},xe={class:"container"},Ne={class:"q-mt-md row justify-end q-gutter-md"},Be=W({props:{roomTypeId:{type:[String,Number],required:!0}},setup(a){const t=a,{notifySaveSuccess:l,notifySaveFailed:s}=Te(),{t:o}=te(),{data:d,isLoading:f}=Ve(),{data:n,isLoading:w}=Se(t.roomTypeId==="new"?0:+t.roomTypeId),k=Fe(),oe=Me(),P=X(()=>f.value||w.value),c=p({capacity_adult:2,capacity_child:0,num_of_bed:1,name:"",code:""});ye(()=>{var e,u,r,_,b,h,g,Q,R,T;c.value={capacity_adult:(u=(e=n.value)==null?void 0:e.capacity_adult)!=null?u:2,capacity_child:(_=(r=n.value)==null?void 0:r.capacity_child)!=null?_:0,num_of_bed:(h=(b=n.value)==null?void 0:b.num_of_bed)!=null?h:1,name:(Q=(g=n.value)==null?void 0:g.name)!=null?Q:"",code:(T=(R=n.value)==null?void 0:R.code)!=null?T:""}});const q=p(null),ae=[e=>!!e||o("this_field_is_required"),e=>Number.isInteger(e)||o("this_is_invalid_value"),e=>1<=e||o("this_value_is_too_small"),e=>e<=10||o("this_value_is_too_big")],E=p(null),le=[e=>!!e||o("this_field_is_required"),e=>Number.isInteger(e)||o("this_is_invalid_value"),e=>0<=e||o("this_is_invalid_value"),e=>e<=10||o("this_value_is_too_big")],x=p(null),se=[e=>!!e||o("this_field_is_required"),e=>Number.isInteger(e)||o("this_is_invalid_value"),e=>1<=e||o("this_value_is_too_small"),e=>e<=10||o("this_value_is_too_big")],N=p(null),re=[e=>!!e||o("this_field_is_required"),e=>e.length<=50||o("this_value_is_too_long"),e=>{var u;return!((u=d.value)==null?void 0:u.filter(r=>{var _;return r.id!==((_=n.value)==null?void 0:_.id)}).some(r=>r.name===e))||o("this_is_invalid_value")}],B=p(null),ue=[e=>!!e||o("this_field_is_required"),e=>e.length<=10||o("this_value_is_too_long"),e=>{var u;return!((u=d.value)==null?void 0:u.filter(r=>{var _;return r.id!==((_=n.value)==null?void 0:_.id)}).some(r=>r.code===e))||o("this_is_invalid_value")}],ne=()=>{var e,u,r,_,b,h,g,Q,R,T;if((e=q.value)==null||e.validate(),(u=E.value)==null||u.validate(),(r=x.value)==null||r.validate(),(_=N.value)==null||_.validate(),(b=B.value)==null||b.validate(),!(((h=q.value)==null?void 0:h.error)||((g=E.value)==null?void 0:g.error)||((Q=x.value)==null?void 0:Q.error)||((R=N.value)==null?void 0:R.error)||((T=B.value)==null?void 0:T.error))){if(t.roomTypeId==="new"){k.mutate(c.value,{onSuccess:()=>{l()},onError:()=>{s()}});return}!n.value||oe.mutate(S(O({},c.value),{id:t.roomTypeId,is_active:n.value.is_active}),{onSuccess:()=>{l()},onError:()=>{s()}})}};return(e,u)=>(v(),ee(Qe,{onSubmit:ne},{default:C(()=>[i(P)?(v(),I("div",ke,[(v(),I(K,null,j(2,r=>m(z,{key:r,type:"QInput"})),64)),M("div",qe,[(v(),I(K,null,j(3,r=>m(z,{key:r,class:"col",type:"QInput"})),64))])])):(v(),I("div",Ee,[m(V,{ref_key:"codeField",ref:B,modelValue:c.value.code,"onUpdate:modelValue":u[0]||(u[0]=r=>c.value.code=r),label:i(o)("room_type_code"),rules:ue},null,8,["modelValue","label"]),m(V,{ref_key:"nameField",ref:N,modelValue:c.value.name,"onUpdate:modelValue":u[1]||(u[1]=r=>c.value.name=r),label:i(o)("room_type_name"),rules:re},null,8,["modelValue","label"]),M("div",xe,[m(V,{ref_key:"numOfBedField",ref:x,modelValue:c.value.num_of_bed,"onUpdate:modelValue":u[2]||(u[2]=r=>c.value.num_of_bed=r),modelModifiers:{number:!0},label:i(o)("number_of_beds"),rules:se,class:"col",type:"number"},null,8,["modelValue","label"]),m(V,{ref_key:"capacityAdultField",ref:q,modelValue:c.value.capacity_adult,"onUpdate:modelValue":u[3]||(u[3]=r=>c.value.capacity_adult=r),modelModifiers:{number:!0},label:i(o)("number_of_adults"),rules:ae,class:"col",type:"number"},null,8,["modelValue","label"]),m(V,{ref_key:"capacityChildField",ref:E,modelValue:c.value.capacity_child,"onUpdate:modelValue":u[4]||(u[4]=r=>c.value.capacity_child=r),modelModifiers:{number:!0},label:i(o)("number_of_children"),rules:le,class:"col",type:"number"},null,8,["modelValue","label"])])])),M("div",Ne,[ve(m(H,{label:i(o)("cancel"),flat:"",type:"button"},null,8,["label"]),[[Re]]),m(H,{label:i(o)("save"),color:"orange-9",type:"submit",disable:i(P)},null,8,["label","disable"])])]),_:1}))}});var Ue=Ce(Be,[["__scopeId","data-v-ae84c5da"]]);const Pe={class:"text-h6"},et=W({setup(a){const t=fe(),l=be(),{t:s}=te(),o=p(!1),d=X(()=>{const{roomTypeId:n}=l.params;return Array.isArray(n)?null:n==="new"?"new":typeof+n=="number"?+n:null});he(()=>o.value=!0);const f=()=>{t.replace({path:"/settings/room-settings",query:l.query})};return(n,w)=>i(d)?(v(),ee(_e,{key:0,modelValue:o.value,"onUpdate:modelValue":w[0]||(w[0]=k=>o.value=k),onHide:f},{default:C(()=>[m(me,{style:{width:"700px","max-width":"80vw"}},{default:C(()=>[m(D,null,{default:C(()=>[M("div",Pe,Z(i(d)==="new"?i(s)("new_room_type"):i(s)("edit_room_type"))+" "+Z(i(t).options.history.state.code),1)]),_:1}),m(D,{class:"q-pt-none"},{default:C(()=>[m(Ue,{"room-type-id":i(d)},null,8,["room-type-id"])]),_:1})]),_:1})]),_:1},8,["modelValue"])):ge("v-if",!0)}});export{et as default};
