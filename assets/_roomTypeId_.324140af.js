var pe=Object.defineProperty,ye=Object.defineProperties;var _e=Object.getOwnPropertyDescriptors;var S=Object.getOwnPropertySymbols;var z=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable;var J=(o,e,r)=>e in o?pe(o,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[e]=r,T=(o,e)=>{for(var r in e||(e={}))z.call(e,r)&&J(o,r,e[r]);if(S)for(var r of S(e))G.call(e,r)&&J(o,r,e[r]);return o},R=(o,e)=>ye(o,_e(e));var W=(o,e)=>{var r={};for(var t in o)z.call(o,t)&&e.indexOf(t)<0&&(r[t]=o[t]);if(o!=null&&S)for(var t of S(o))e.indexOf(t)<0&&G.call(o,t)&&(r[t]=o[t]);return r};import{Q as X,a as fe}from"./QCard.f555a3ba.js";import{Q as ve}from"./QDialog.d32564a8.js";import{_ as Z,aH as ee,h as be,d as oe,m as j,o as f,n as ae,w as b,u as a,c as h,F as re,K as te,a as m,j as C,$ as g,D as ge,R as Qe,q as se,g as Ve,bb as Me,l as Se,am as Te,H as Re,C as ne}from"./vendor.c8a9d970.js";import{Q as _,a as k,_ as he,u as ue}from"./index.76f5ac2d.js";import{Q as le}from"./QSkeleton.65ce05dd.js";import{t as Ce,e as v,a as we,b as Q,Q as V}from"./index.81cacef1.js";import{Q as xe}from"./QForm.7452a6c8.js";import{u as Oe,a as Ee}from"./useNotify.2d4fb18f.js";const Ie=async o=>{const{data:e}=await k.post("/rooms/room_type/create/",o);return e},Fe=()=>{const o=ee();return Z(Ie,{onSuccess:e=>{const r=o.getQueryData(_.ROOM_TYPES);!r||o.setQueryData(_.ROOM_TYPES,()=>[{id:e.id,num_of_room:0,code:e.code,name:e.name},...r])}})},je=async({queryKey:o})=>{const[,e]=o;if(!e)return;const{data:r}=await k.get(`/rooms/room_type/get/${e}`);return r},ke=o=>{const e=[_.ROOM_TYPES,o];return be(e,je)},qe=async r=>{var t=r,{id:o}=t,e=W(t,["id"]);const{data:u}=await k.put(`/rooms/room_type/update/${o}`,e);return u},Ue=()=>{const o=ee(),e=t=>{const u=o.getQueryData(_.ROOM_TYPES);!u||o.setQueryData(_.ROOM_TYPES,()=>u.map(i=>i.id!==t.id?i:{id:t.id,num_of_room:i.num_of_room,name:t.name,code:t.code}))},r=t=>{const u=o.getQueryData(_.ROOMS);!u||o.setQueryData(_.ROOMS,()=>u.map(i=>{const l=i.list_rooms.map(c=>R(T({},c),{room_type_code:t.code}));return R(T({},i),{list_rooms:l})}))};return Z(qe,{onSuccess:t=>{e(t),r(t)}})};const Be={key:0,class:"wrapper"},De={class:"container"},Ye={key:1,class:"wrapper"},$e={class:"container"},Le={class:"q-mt-md row justify-end q-gutter-md"},Ne=oe({props:{roomTypeId:{type:[String,Number],required:!0}},setup(o){const e=o,{notifySaveSuccess:r,notifySaveFailed:t}=Oe(),{data:u,isLoading:i}=Ee(),{data:l,isLoading:c}=ke(e.roomTypeId==="new"?0:+e.roomTypeId),M=Fe(),w=Ue(),q=j(()=>i.value||c.value),me=Ce(v.object({capacity_adult:v.number().int().min(1).max(10),capacity_child:v.number().int().min(0).max(10),num_of_bed:v.number().int().min(1).max(10),name:v.string().max(50).nonempty().refine(d=>{var n;return!((n=u.value)==null?void 0:n.filter(s=>{var p;return s.id!==((p=l.value)==null?void 0:p.id)}).some(s=>s.name===d))}),code:v.string().max(10).nonempty().refine(d=>{var n;return!((n=u.value)==null?void 0:n.filter(s=>{var p;return s.id!==((p=l.value)==null?void 0:p.id)}).some(s=>s.code===d))})})),{t:y}=ue(),ie=j(()=>{var d,n,s,p,L,N,P,A,H,K;return{capacity_adult:(n=(d=l.value)==null?void 0:d.capacity_adult)!=null?n:2,capacity_child:(p=(s=l.value)==null?void 0:s.capacity_child)!=null?p:0,num_of_bed:(N=(L=l.value)==null?void 0:L.num_of_bed)!=null?N:1,name:(A=(P=l.value)==null?void 0:P.name)!=null?A:"",code:(K=(H=l.value)==null?void 0:H.code)!=null?K:""}}),{handleSubmit:de}=we({validationSchema:me,initialValues:ie}),{value:x,errorMessage:U}=Q("capacity_adult"),{value:O,errorMessage:B}=Q("capacity_child"),{value:E,errorMessage:D}=Q("num_of_bed"),{value:I,errorMessage:Y}=Q("name"),{value:F,errorMessage:$}=Q("code"),ce=de(d=>{if(e.roomTypeId==="new"){M.mutate(d,{onSuccess:()=>{r()},onError:()=>{t()}});return}!l.value||w.mutate(R(T({},d),{id:e.roomTypeId,is_active:l.value.is_active}),{onSuccess:()=>{r()},onError:()=>{t()}})});return(d,n)=>(f(),ae(xe,{onSubmit:a(ce)},{default:b(()=>[a(q)?(f(),h("div",Be,[(f(),h(re,null,te(2,s=>m(le,{key:s,type:"QInput"})),64)),C("div",De,[(f(),h(re,null,te(3,s=>m(le,{key:s,class:"col",type:"QInput"})),64))])])):(f(),h("div",Ye,[m(V,{modelValue:a(F),"onUpdate:modelValue":n[0]||(n[0]=s=>g(F)?F.value=s:null),label:a(y)("room_type_code"),"error-message":a($),error:!!a($)},null,8,["modelValue","label","error-message","error"]),m(V,{modelValue:a(I),"onUpdate:modelValue":n[1]||(n[1]=s=>g(I)?I.value=s:null),label:a(y)("room_type_name"),"error-message":a(Y),error:!!a(Y)},null,8,["modelValue","label","error-message","error"]),C("div",$e,[m(V,{modelValue:a(E),"onUpdate:modelValue":n[2]||(n[2]=s=>g(E)?E.value=s:null),modelModifiers:{number:!0},label:a(y)("number_of_beds"),"error-message":a(D),error:!!a(D),class:"col",type:"number"},null,8,["modelValue","label","error-message","error"]),m(V,{modelValue:a(x),"onUpdate:modelValue":n[3]||(n[3]=s=>g(x)?x.value=s:null),modelModifiers:{number:!0},label:a(y)("number_of_adults"),"error-message":a(U),error:!!a(U),class:"col",type:"number"},null,8,["modelValue","label","error-message","error"]),m(V,{modelValue:a(O),"onUpdate:modelValue":n[4]||(n[4]=s=>g(O)?O.value=s:null),modelModifiers:{number:!0},label:a(y)("number_of_children"),"error-message":a(B),error:!!a(B),class:"col",type:"number"},null,8,["modelValue","label","error-message","error"])])])),C("div",Le,[ge(m(se,{label:a(y)("cancel"),flat:"",type:"button"},null,8,["label"]),[[Qe]]),m(se,{label:a(y)("save"),color:"orange-9",type:"submit",disable:a(q)},null,8,["label","disable"])])]),_:1},8,["onSubmit"]))}});var Pe=he(Ne,[["__scopeId","data-v-ae84c5da"]]);const Ae={class:"text-h6"},oo=oe({setup(o){const e=Ve(),r=Me(),{t}=ue(),u=Se(!1),i=j(()=>{const{roomTypeId:c}=r.params;return Array.isArray(c)?null:c==="new"?"new":typeof+c=="number"?+c:null});Te(()=>u.value=!0);const l=()=>{e.replace({path:"/settings/room-settings",query:r.query})};return(c,M)=>a(i)?(f(),ae(ve,{key:0,modelValue:u.value,"onUpdate:modelValue":M[0]||(M[0]=w=>u.value=w),onHide:l},{default:b(()=>[m(fe,{style:{width:"700px","max-width":"80vw"}},{default:b(()=>[m(X,null,{default:b(()=>[C("div",Ae,ne(a(i)==="new"?a(t)("new_room_type"):a(t)("edit_room_type"))+" "+ne(a(e).options.history.state.code),1)]),_:1}),m(X,{class:"q-pt-none"},{default:b(()=>[m(Pe,{"room-type-id":a(i)},null,8,["room-type-id"])]),_:1})]),_:1})]),_:1},8,["modelValue"])):Re("v-if",!0)}});export{oo as default};
