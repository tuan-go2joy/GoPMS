var Ee=Object.defineProperty,Fe=Object.defineProperties;var xe=Object.getOwnPropertyDescriptors;var oe=Object.getOwnPropertySymbols;var Ve=Object.prototype.hasOwnProperty,Me=Object.prototype.propertyIsEnumerable;var ae=(e,t,o)=>t in e?Ee(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,A=(e,t)=>{for(var o in t||(t={}))Ve.call(t,o)&&ae(e,o,t[o]);if(oe)for(var o of oe(t))Me.call(t,o)&&ae(e,o,t[o]);return e},re=(e,t)=>Fe(e,xe(t));import{Q as Ne,a as T,c as k,b as le}from"./QMenu.1058eb8d.js";import{j as ge,k as q,i as D,l as z,n as E,w as Z,R as $e,P as De,y as be,t as Ie,aL as Le,aM as Be,u as i,aN as J,aO as X,d as we,aP as Ce,o as g,$ as R,a0 as d,aQ as N,aR as x,s as I,a as c,I as j,q as ne,a1 as L,a2 as B,r as Pe,c as U,aS as se,F as ie,a4 as ue,Z as ce,a5 as de}from"./vendor.71878d25.js";import{Q as Ae}from"./QList.0d53262f.js";import{a as ee,Q as Se}from"./axiosClient.da76d854.js";import{T as ze}from"./TouchPan.eb796217.js";import{u as Te,a as je,d as Qe}from"./useI18n.26b256e3.js";import{u as qe}from"./useNotify.2ba89e99.js";import{r as K}from"./index.9ec40e6f.js";import{Q as C}from"./queryKeys.336f5b66.js";import{u as Re,a as Ke}from"./useRoomsQuery.fed9440d.js";import{u as Ue}from"./useRoomTypesQuery.2b2e1ed3.js";import{Q as We}from"./QSeparator.7c4639a0.js";import{Q as Ye}from"./QTable.bd063007.js";import{C as me}from"./ClosePopup.cdbaede7.js";import"./use-prevent-scroll.15991844.js";import"./QSelect.1cdad3a5.js";const Ze=["top","middle","bottom"];var fe=ge({name:"QBadge",props:{color:String,textColor:String,floating:Boolean,transparent:Boolean,multiLine:Boolean,outline:Boolean,rounded:Boolean,label:[Number,String],align:{type:String,validator:e=>Ze.includes(e)}},setup(e,{slots:t}){const o=q(()=>e.align!==void 0?{verticalAlign:e.align}:null),a=q(()=>{const r=e.outline===!0&&e.color||e.textColor;return`q-badge flex inline items-center no-wrap q-badge--${e.multiLine===!0?"multi":"single"}-line`+(e.outline===!0?" q-badge--outline":e.color!==void 0?` bg-${e.color}`:"")+(r!==void 0?` text-${r}`:"")+(e.floating===!0?" q-badge--floating":"")+(e.rounded===!0?" q-badge--rounded":"")+(e.transparent===!0?" q-badge--transparent":"")});return()=>D("div",{class:a.value,style:o.value,role:"alert","aria-label":e.label},e.label!==void 0?e.label:z(t.default))}}),Ge=ge({name:"QSplitter",props:re(A({},Te),{modelValue:{type:Number,required:!0},reverse:Boolean,unit:{type:String,default:"%",validator:e=>["%","px"].includes(e)},limits:{type:Array,validator:e=>e.length!==2||typeof e[0]!="number"||typeof e[1]!="number"?!1:e[0]>=0&&e[0]<=e[1]},emitImmediately:Boolean,horizontal:Boolean,disable:Boolean,beforeClass:[Array,String,Object],afterClass:[Array,String,Object],separatorClass:[Array,String,Object],separatorStyle:[Array,String,Object]}),emits:["update:modelValue"],setup(e,{slots:t,emit:o}){const{proxy:{$q:a}}=Ie(),r=je(e,a),n=E(null),f={before:E(null),after:E(null)},y=q(()=>`q-splitter no-wrap ${e.horizontal===!0?"q-splitter--horizontal column":"q-splitter--vertical row"} q-splitter--${e.disable===!0?"disabled":"workable"}`+(r.value===!0?" q-splitter--dark":"")),b=q(()=>e.horizontal===!0?"height":"width"),_=q(()=>e.reverse!==!0?"before":"after"),p=q(()=>e.limits!==void 0?e.limits:e.unit==="%"?[10,90]:[50,1/0]);function h(l){return(e.unit==="%"?l:Math.round(l))+e.unit}const S=q(()=>({[_.value]:{[b.value]:h(e.modelValue)}}));let w,F,O,V,Q;function $(l){if(l.isFirst===!0){const u=n.value.getBoundingClientRect()[b.value];w=e.horizontal===!0?"up":"left",F=e.unit==="%"?100:u,O=Math.min(F,p.value[1],Math.max(p.value[0],e.modelValue)),V=(e.reverse!==!0?1:-1)*(e.horizontal===!0?1:a.lang.rtl===!0?-1:1)*(e.unit==="%"?u===0?0:100/u:1),n.value.classList.add("q-splitter--active");return}if(l.isFinal===!0){Q!==e.modelValue&&o("update:modelValue",Q),n.value.classList.remove("q-splitter--active");return}const s=O+V*(l.direction===w?-1:1)*l.distance[e.horizontal===!0?"y":"x"];Q=Math.min(F,p.value[1],Math.max(p.value[0],s)),f[_.value].value.style[b.value]=h(Q),e.emitImmediately===!0&&e.modelValue!==Q&&o("update:modelValue",Q)}const m=q(()=>[[ze,$,void 0,{[e.horizontal===!0?"vertical":"horizontal"]:!0,prevent:!0,stop:!0,mouse:!0,mouseAllDir:!0}]]);function v(l,s){l<s[0]?o("update:modelValue",s[0]):l>s[1]&&o("update:modelValue",s[1])}return Z(()=>e.modelValue,l=>{v(l,p.value)}),Z(()=>e.limits,()=>{be(()=>{v(e.modelValue,p.value)})}),()=>{const l=[D("div",{ref:f.before,class:["q-splitter__panel q-splitter__before"+(e.reverse===!0?" col":""),e.beforeClass],style:S.value.before},z(t.before)),D("div",{class:["q-splitter__separator",e.separatorClass],style:e.separatorStyle,"aria-disabled":e.disable===!0?"true":void 0},[$e("div",{class:"q-splitter__separator-area absolute-full"},z(t.separator),"sep",e.disable!==!0,()=>m.value)]),D("div",{ref:f.after,class:["q-splitter__panel q-splitter__after"+(e.reverse===!0?"":" col"),e.afterClass],style:S.value.after},z(t.after))];return D("div",{class:y.value,ref:n},De(t.default,l))}}});function He(e){return Le()?(Be(e),!0):!1}const P=typeof window!="undefined",Je=e=>typeof e=="string",W=()=>{};function Y(e){var t;const o=i(e);return(t=o==null?void 0:o.$el)!=null?t:o}const Oe=P?window:void 0;P&&window.document;P&&window.navigator;P&&window.location;function _e(...e){let t,o,a,r;if(Je(e[0])?([o,a,r]=e,t=Oe):[t,o,a,r]=e,!t)return W;let n=W;const f=Z(()=>i(t),b=>{n(),!!b&&(b.addEventListener(o,a,r),n=()=>{b.removeEventListener(o,a,r),n=W})},{immediate:!0,flush:"post"}),y=()=>{f(),n()};return He(y),y}function Xe(e,t,o={}){const{window:a=Oe,ignore:r}=o;if(!a)return;const n=E(!0),y=[_e(a,"click",_=>{const p=Y(e),h=_.composedPath();!p||p===_.target||h.includes(p)||!n.value||r&&r.length>0&&r.some(S=>{const w=Y(S);return w&&(_.target===w||h.includes(w))})||t(_)},{passive:!0,capture:!0}),_e(a,"pointerdown",_=>{const p=Y(e);n.value=!!p&&!_.composedPath().includes(p)},{passive:!0})];return()=>y.forEach(_=>_())}const G=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},H="__vueuse_ssr_handlers__";G[H]=G[H]||{};G[H];var ve,pe;P&&(window==null?void 0:window.navigator)&&((ve=window==null?void 0:window.navigator)==null?void 0:ve.platform)&&/iP(ad|hone|od)/.test((pe=window==null?void 0:window.navigator)==null?void 0:pe.platform);var et=Object.defineProperty,ye=Object.getOwnPropertySymbols,tt=Object.prototype.hasOwnProperty,ot=Object.prototype.propertyIsEnumerable,he=(e,t,o)=>t in e?et(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,at=(e,t)=>{for(var o in t||(t={}))tt.call(t,o)&&he(e,o,t[o]);if(ye)for(var o of ye(t))ot.call(t,o)&&he(e,o,t[o]);return e};const rt={top:0,left:0,bottom:0,right:0,height:0,width:0};at({text:""},rt);const ke=e=>{const t=E(!1),o=E(null),a=async()=>{var n;t.value=!0,await be(),(n=o.value)==null||n.focus()},r=()=>{t.value=!1,e==null||e.onFinishEdit()};return Xe(o,()=>r()),{inputElementRef:o,isEditMode:t,startEdit:a,finishEdit:r}},lt=async e=>{const{data:t}=await ee.post("/rooms/floor/create/",e);return t},nt=()=>{const e=X(),t=a=>{const r=e.getQueryData(C.FLOORS);!r||e.setQueryData(C.FLOORS,()=>[...r,A({},a)])},o=a=>{const r=e.getQueryData(C.ROOMS);!r||e.setQueryData(C.ROOMS,()=>[...r,{room_floor_id:a.id,room_floor_name:a.name,list_rooms:[]}])};return J(lt,{onSuccess:a=>{t(a),o(a)}})},st=async({floor_id:e})=>{await ee.delete(`/rooms/floor/delete/${e}`)},it=()=>{const e=X(),t=a=>{const r=e.getQueryData(C.FLOORS);!r||e.setQueryData(C.FLOORS,()=>r.filter(n=>n.id!==a.floor_id))},o=a=>{const r=e.getQueryData(C.ROOMS);!r||e.setQueryData(C.ROOMS,()=>r.filter(n=>n.room_floor_id!==a.floor_id))};return J(st,{onSuccess:(a,r)=>{t(r),o(r)}})},ut=async({floor_id:e,name:t})=>{const{data:o}=await ee.put(`/rooms/floor/update/${e}`,{name:t});return o},ct=()=>{const e=X(),t=a=>{const r=e.getQueryData(C.FLOORS);!r||e.setQueryData(C.FLOORS,()=>r.map(n=>n.id!==a.id?n:A({},a)))},o=a=>{const r=e.getQueryData(C.ROOMS);!r||e.setQueryData(C.ROOMS,()=>r.map(n=>n.room_floor_id!==a.id?n:{room_floor_id:a.id,room_floor_name:a.name,list_rooms:n.list_rooms}))};return J(ut,{onSuccess:a=>{t(a),o(a)}})},dt=we({props:{floorName:{type:String,required:!0},floorId:{type:Number,required:!0},rooms:{type:Array,required:!0}},setup(e){const t=e,{data:o}=Re(),{notifySaveSuccess:a,notifySaveFailed:r,notifyWarning:n}=qe(),f=Ce(),{t:y}=Qe(),b=q(()=>{const{code:l}=f.query;return!l||Array.isArray(l)?t.rooms:t.rooms.filter(({room_type_code:s})=>s===l.replaceAll("_"," "))}),_=ct(),p=it(),h=E(t.floorName),{inputElementRef:S,isEditMode:w,startEdit:F,finishEdit:O}=ke({onFinishEdit:()=>h.value=t.floorName}),V=[l=>!!l||y("this_is_invalid_value"),l=>l.length<=10||y("this_value_is_too_long"),l=>{var s;return!((s=o.value)==null?void 0:s.some(({name:u})=>u===l))||y("this_is_invalid_value")}],Q=async l=>{var u,M;if((u=S.value)==null||u.validate(),(M=S.value)==null?void 0:M.error)return;const{value:s}=l.currentTarget;_.mutate({floor_id:t.floorId,name:s},{onSuccess:()=>{a(),O()},onError:()=>{r()}})},$=()=>{if(t.rooms.length!==0){n(y("please_remove_all_rooms_of_this_floor"));return}p.mutate({floor_id:t.floorId},{onSuccess:()=>{a()},onError:()=>{r()}})},m=(l,s)=>{K.replace({path:`/settings/room-settings/rooms/${s.id}`,state:{roomName:s.name,floorId:t.floorId},query:f.query})},v=()=>{K.replace({path:"/settings/room-settings/rooms/new",state:{roomName:null,floorId:t.floorId},query:f.query})};return(l,s)=>(g(),R(Ye,{grid:"",title:t.floorName,rows:i(b),columns:[{name:"room_type_code",label:"Room Type Code",field:u=>u.room_type_code},{name:"name",label:"Room Name",field:u=>u.name}],"hide-pagination":"",onRowClick:m},{"top-left":d(()=>[i(w)?(g(),R(Se,{key:0,ref_key:"inputElementRef",ref:S,modelValue:h.value,"onUpdate:modelValue":s[0]||(s[0]=u=>h.value=u),class:"text-h5",rules:V,placeholder:i(y)("input_floor_name"),filled:"",dense:"",onKeydown:[N(x(Q,["prevent"]),["enter"]),N(x(i(O),["prevent"]),["esc"]),N(x(i(O),["prevent"]),["tab"])]},null,8,["modelValue","placeholder","onKeydown"])):(g(),R(I,{key:1,label:t.floorName,class:"text-h5",padding:"xs 12px","no-caps":"",dense:"",flat:"",onClick:i(F)},null,8,["label","onClick"]))]),"top-right":d(()=>[c(I,{flat:"",round:"",icon:"more_vert"},{default:d(()=>[c(Ne,{anchor:"bottom right",self:"top right"},{default:d(()=>[j((g(),R(T,{clickable:"",onClick:v},{default:d(()=>[c(k,{side:""},{default:d(()=>[c(ne,{name:"add"})]),_:1}),c(k,null,{default:d(()=>[L(B(i(y)("add_new_room")),1)]),_:1})]),_:1})),[[me]]),c(We),j((g(),R(T,{clickable:"",onClick:$},{default:d(()=>[c(k,{side:""},{default:d(()=>[c(ne,{name:"delete"})]),_:1}),c(k,null,{default:d(()=>[L(B(i(y)("delete_floor")),1)]),_:1})]),_:1})),[[me]])]),_:1})]),_:1})]),_:1},8,["title","rows","columns"]))}}),mt={class:"row"},ft={class:"q-my-xl row justify-center"},Vt=we({setup(e){const{data:t}=Ue(),{data:o}=Re(),{data:a}=Ke(),r=nt(),n=Ce(),{t:f}=Qe(),{notifySaveSuccess:y,notifySaveFailed:b}=qe(),_=E(""),p=[m=>!!m||f("this_is_invalid_value"),m=>m.length<=10||f("this_value_is_too_long"),m=>{var v;return!((v=o.value)==null?void 0:v.some(({name:l})=>l===m))||f("this_is_invalid_value")}],{inputElementRef:h,isEditMode:S,finishEdit:w,startEdit:F}=ke({onFinishEdit:()=>_.value=""}),O=q(()=>{var v;let m=0;return(v=t.value)==null||v.forEach(({num_of_room:l})=>m+=l),m}),V=async()=>{var m,v;(m=h.value)==null||m.validate(),!((v=h.value)==null?void 0:v.error)&&r.mutate({name:_.value},{onSuccess:()=>{y(),w()},onError:()=>{b()}})},Q=()=>{console.log("Create new room type"),K.replace({path:"/settings/room-settings/room-types/new",query:n.query,state:{code:null}})},$=(m,v)=>{console.log("Edit room type",m),K.replace({path:`/settings/room-settings/room-types/${m}`,query:n.query,state:{code:v}})};return(m,v)=>{const l=Pe("router-view");return g(),U("div",null,[c(Ge,{"model-value":15,"before-class":"q-px-sm","separator-style":"background-color: transparent;"},{before:d(()=>[c(Ae,{separator:"",bordered:""},{default:d(()=>[j((g(),R(T,{to:"/settings/room-settings",replace:""},{default:d(()=>[c(k,{class:se([i(n).query.code?"text-black":"text-primary"])},{default:d(()=>[L(B(i(f)("all")),1)]),_:1},8,["class"]),c(k,{side:""},{default:d(()=>[c(fe,{label:i(O),rounded:""},null,8,["label"])]),_:1})]),_:1})),[[de]]),(g(!0),U(ie,null,ue(i(t),({num_of_room:s,code:u,name:M,id:te})=>j((g(),R(T,{key:te,to:`/settings/room-settings?code=${u.replaceAll(" ","_")}`,replace:""},{default:d(()=>[c(k,null,{default:d(()=>[c(le,{class:se([i(n).query.code===u.replaceAll(" ","_")?"text-primary":"text-black"])},{default:d(()=>[L(B(u)+" ",1),c(fe,{label:s,rounded:""},null,8,["label"])]),_:2},1032,["class"]),c(le,{caption:""},{default:d(()=>[L(B(M),1)]),_:2},1024)]),_:2},1024),c(k,{side:""},{default:d(()=>[c(I,{icon:"edit",flat:"",round:"",onClick:x(_t=>$(te,u),["prevent"])},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["to"])),[[de]])),128))]),_:1}),ce("div",mt,[c(I,{label:i(f)("new_room_type"),class:"col q-my-md",icon:"add_circle",stretch:"",onClick:Q},null,8,["label"])])]),after:d(()=>[(g(!0),U(ie,null,ue(i(a),({room_floor_name:s,room_floor_id:u,list_rooms:M})=>(g(),R(dt,{key:u,"floor-name":s,"floor-id":u,rooms:M},null,8,["floor-name","floor-id","rooms"]))),128)),ce("div",ft,[i(S)?(g(),R(Se,{key:0,ref_key:"inputElementRef",ref:h,modelValue:_.value,"onUpdate:modelValue":v[0]||(v[0]=s=>_.value=s),rules:p,class:"h-sm",placeholder:i(f)("input_floor_name"),filled:"",onKeydown:[N(x(V,["prevent"]),["enter"]),N(x(i(w),["prevent"]),["esc"]),N(x(i(w),["prevent"]),["tab"])]},null,8,["modelValue","placeholder","onKeydown"])):(g(),R(I,{key:1,label:i(f)("new_floor"),icon:"add_circle",onClick:i(F)},null,8,["label","onClick"]))])]),_:1}),c(l)])}}});export{Vt as default};
