var ie=Object.defineProperty,de=Object.defineProperties;var ce=Object.getOwnPropertyDescriptors;var S=Object.getOwnPropertySymbols;var P=Object.prototype.hasOwnProperty,Y=Object.prototype.propertyIsEnumerable;var D=(a,t,l)=>t in a?ie(a,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[t]=l,w=(a,t)=>{for(var l in t||(t={}))P.call(t,l)&&D(a,l,t[l]);if(S)for(var l of S(t))Y.call(t,l)&&D(a,l,t[l]);return a},O=(a,t)=>de(a,ce(t));var L=(a,t)=>{var l={};for(var s in a)P.call(a,s)&&t.indexOf(s)<0&&(l[s]=a[s]);if(a!=null&&S)for(var s of S(a))t.indexOf(s)<0&&Y.call(a,s)&&(l[s]=a[s]);return l};import{Q as $,a as _e}from"./QCard.b9f01302.js";import{Q as me}from"./QDialog.dde3e87a.js";import{au as A,aG as K,_ as pe,d as G,k as H,p,aQ as ye,o as f,a1 as Z,a2 as C,u as i,c as I,F as z,a6 as J,a as _,a0 as M,K as fe,v as W,Z as ve,aM as be,q as he,a4 as X,a5 as Qe}from"./vendor.c8940223.js";import{d as U,e as ee}from"./axiosClient.fba0db00.js";import{Q as te}from"./QSkeleton.657ae1f3.js";import{Q as V}from"./use-quasar.6c925fdd.js";import{Q as ge}from"./QForm.0fcc3426.js";import{C as Re}from"./ClosePopup.e5424fb2.js";import{u as Te,a as Ce}from"./useRoomTypesQuery.51027ea3.js";import{Q as y}from"./queryKeys.f0c0fd01.js";import{_ as Ve}from"./plugin-vue_export-helper.21dcd24c.js";import"./index.93a91d69.js";const Fe=async a=>{const{data:t}=await U.post("/rooms/room_type/create/",a);return t},Se=()=>{const a=K();return A(Fe,{onSuccess:t=>{const l=a.getQueryData(y.ROOM_TYPES);!l||a.setQueryData(y.ROOM_TYPES,()=>[{id:t.id,num_of_room:0,code:t.code,name:t.name},...l])}})},we=async({queryKey:a})=>{const[,t]=a;if(!t)return;const{data:l}=await U.get(`/rooms/room_type/get/${t}`);return l},Oe=a=>{const t=[y.ROOM_TYPES,a];return pe(t,we)},Ie=async l=>{var s=l,{id:a}=s,t=L(s,["id"]);const{data:o}=await U.put(`/rooms/room_type/update/${a}`,t);return o},Me=()=>{const a=K(),t=s=>{const o=a.getQueryData(y.ROOM_TYPES);!o||a.setQueryData(y.ROOM_TYPES,()=>o.map(d=>d.id!==s.id?d:{id:s.id,num_of_room:d.num_of_room,name:s.name,code:s.code}))},l=s=>{const o=a.getQueryData(y.ROOMS);!o||a.setQueryData(y.ROOMS,()=>o.map(d=>{const v=d.list_rooms.map(n=>O(w({},n),{room_type_code:s.code}));return O(w({},d),{list_rooms:v})}))};return A(Ie,{onSuccess:s=>{t(s),l(s)}})};const ke={key:0,class:"wrapper"},qe={class:"container"},je={key:1,class:"wrapper"},xe={class:"container"},Ee={class:"q-mt-md row justify-end q-gutter-md"},Be=G({props:{roomTypeId:null},setup(a){const t=a,{notifySaveSuccess:l,notifySaveFailed:s}=Te(),{t:o}=ee(),{data:d,isLoading:v}=Ce(),{data:n,isLoading:F}=Oe(t.roomTypeId==="new"?0:+t.roomTypeId),k=Se(),oe=Me(),N=H(()=>v.value||F.value),c=p({capacity_adult:2,capacity_child:0,num_of_bed:1,name:"",code:""});ye(()=>{var e,r,u,m,b,h,Q,g,R,T;c.value={capacity_adult:(r=(e=n.value)==null?void 0:e.capacity_adult)!=null?r:2,capacity_child:(m=(u=n.value)==null?void 0:u.capacity_child)!=null?m:0,num_of_bed:(h=(b=n.value)==null?void 0:b.num_of_bed)!=null?h:1,name:(g=(Q=n.value)==null?void 0:Q.name)!=null?g:"",code:(T=(R=n.value)==null?void 0:R.code)!=null?T:""}});const q=p(null),ae=[e=>!!e||o("this_field_is_required"),e=>Number.isInteger(e)||o("this_is_invalid_value"),e=>1<=e||o("this_value_is_too_small"),e=>e<=10||o("this_value_is_too_big")],j=p(null),le=[e=>!!e||o("this_field_is_required"),e=>Number.isInteger(e)||o("this_is_invalid_value"),e=>0<=e||o("this_is_invalid_value"),e=>e<=10||o("this_value_is_too_big")],x=p(null),se=[e=>!!e||o("this_field_is_required"),e=>Number.isInteger(e)||o("this_is_invalid_value"),e=>1<=e||o("this_value_is_too_small"),e=>e<=10||o("this_value_is_too_big")],E=p(null),ue=[e=>!!e||o("this_field_is_required"),e=>e.length<=50||o("this_value_is_too_long"),e=>{var r;return!((r=d.value)==null?void 0:r.filter(u=>{var m;return u.id!==((m=n.value)==null?void 0:m.id)}).some(u=>u.name===e))||o("this_is_invalid_value")}],B=p(null),re=[e=>!!e||o("this_field_is_required"),e=>e.length<=10||o("this_value_is_too_long"),e=>{var r;return!((r=d.value)==null?void 0:r.filter(u=>{var m;return u.id!==((m=n.value)==null?void 0:m.id)}).some(u=>u.code===e))||o("this_is_invalid_value")}],ne=()=>{var e,r,u,m,b,h,Q,g,R,T;if((e=q.value)==null||e.validate(),(r=j.value)==null||r.validate(),(u=x.value)==null||u.validate(),(m=E.value)==null||m.validate(),(b=B.value)==null||b.validate(),!(((h=q.value)==null?void 0:h.error)||((Q=j.value)==null?void 0:Q.error)||((g=x.value)==null?void 0:g.error)||((R=E.value)==null?void 0:R.error)||((T=B.value)==null?void 0:T.error))){if(t.roomTypeId==="new"){k.mutate(c.value,{onSuccess:()=>{l()},onError:()=>{s()}});return}!n.value||oe.mutate(O(w({},c.value),{id:t.roomTypeId,is_active:n.value.is_active}),{onSuccess:()=>{l()},onError:()=>{s()}})}};return(e,r)=>(f(),Z(ge,{onSubmit:ne},{default:C(()=>[i(N)?(f(),I("div",ke,[(f(),I(z,null,J(2,u=>_(te,{key:u,type:"QInput"})),64)),M("div",qe,[(f(),I(z,null,J(3,u=>_(te,{key:u,class:"col",type:"QInput"})),64))])])):(f(),I("div",je,[_(V,{ref_key:"codeField",ref:B,modelValue:c.value.code,"onUpdate:modelValue":r[0]||(r[0]=u=>c.value.code=u),label:i(o)("room_type_code"),rules:re},null,8,["modelValue","label"]),_(V,{ref_key:"nameField",ref:E,modelValue:c.value.name,"onUpdate:modelValue":r[1]||(r[1]=u=>c.value.name=u),label:i(o)("room_type_name"),rules:ue},null,8,["modelValue","label"]),M("div",xe,[_(V,{ref_key:"numOfBedField",ref:x,modelValue:c.value.num_of_bed,"onUpdate:modelValue":r[2]||(r[2]=u=>c.value.num_of_bed=u),modelModifiers:{number:!0},label:i(o)("number_of_beds"),rules:se,class:"col",type:"number"},null,8,["modelValue","label"]),_(V,{ref_key:"capacityAdultField",ref:q,modelValue:c.value.capacity_adult,"onUpdate:modelValue":r[3]||(r[3]=u=>c.value.capacity_adult=u),modelModifiers:{number:!0},label:i(o)("number_of_adults"),rules:ae,class:"col",type:"number"},null,8,["modelValue","label"]),_(V,{ref_key:"capacityChildField",ref:j,modelValue:c.value.capacity_child,"onUpdate:modelValue":r[4]||(r[4]=u=>c.value.capacity_child=u),modelModifiers:{number:!0},label:i(o)("number_of_children"),rules:le,class:"col",type:"number"},null,8,["modelValue","label"])])])),M("div",Ee,[fe(_(W,{label:i(o)("cancel"),flat:"",type:"button"},null,8,["label"]),[[Re]]),_(W,{label:i(o)("save"),color:"orange-9",type:"submit",disable:i(N)},null,8,["label","disable"])])]),_:1}))}});var Ue=Ve(Be,[["__scopeId","data-v-cbb39d38"]]);const Ne={class:"text-h6"},Xe=G({setup(a){const t=ve(),l=be(),{t:s}=ee(),o=p(!1),d=H(()=>{const{roomTypeId:n}=l.params;return Array.isArray(n)?null:n==="new"?"new":typeof+n=="number"?+n:null});he(()=>o.value=!0);const v=()=>{t.replace({path:"/settings/room-settings",query:l.query})};return(n,F)=>i(d)?(f(),Z(me,{key:0,modelValue:o.value,"onUpdate:modelValue":F[0]||(F[0]=k=>o.value=k),onHide:v},{default:C(()=>[_(_e,{style:{width:"700px","max-width":"80vw"}},{default:C(()=>[_($,null,{default:C(()=>[M("div",Ne,X(i(d)==="new"?i(s)("new_room_type"):i(s)("edit_room_type"))+" "+X(i(t).options.history.state.code),1)]),_:1}),_($,{class:"q-pt-none"},{default:C(()=>[_(Ue,{"room-type-id":i(d)},null,8,["room-type-id"])]),_:1})]),_:1})]),_:1},8,["modelValue"])):Qe("",!0)}});export{Xe as default};
