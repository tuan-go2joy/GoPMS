var pe=Object.defineProperty,ye=Object.defineProperties;var _e=Object.getOwnPropertyDescriptors;var S=Object.getOwnPropertySymbols;var z=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable;var J=(o,e,t)=>e in o?pe(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t,T=(o,e)=>{for(var t in e||(e={}))z.call(e,t)&&J(o,t,e[t]);if(S)for(var t of S(e))G.call(e,t)&&J(o,t,e[t]);return o},R=(o,e)=>ye(o,_e(e));var W=(o,e)=>{var t={};for(var a in o)z.call(o,a)&&e.indexOf(a)<0&&(t[a]=o[a]);if(o!=null&&S)for(var a of S(o))e.indexOf(a)<0&&G.call(o,a)&&(t[a]=o[a]);return t};import{Q as X,a as fe}from"./QCard.c20bfcde.js";import{Q as be}from"./QDialog.3faf22fe.js";import{_ as Z,aH as ee,h as ve,d as oe,m as j,o as f,n as re,w as v,u as r,c as h,F as te,K as ae,a as m,j as C,$ as g,D as ge,R as Qe,q as se,g as Ve,bb as Me,l as Se,am as Te,H as Re,C as ne}from"./vendor.eeb8c9cb.js";import{Q as _,a as k,_ as he,u as ue}from"./index.79b96d91.js";import{Q as le}from"./QSkeleton.bf4df3d0.js";import{t as Ce,e as b,a as we,b as Q,Q as V}from"./index.e9c5546a.js";import{Q as xe}from"./QForm.d45826d0.js";import{u as Oe,a as Ee}from"./useNotify.283984e3.js";const Ie=async o=>{const{data:e}=await k.post("/rooms/room_type/create/",o);return e},Fe=()=>{const o=ee();return Z(Ie,{onSuccess:e=>{const t=o.getQueryData(_.ROOM_TYPES);!t||o.setQueryData(_.ROOM_TYPES,()=>[{id:e.id,num_of_room:0,code:e.code,name:e.name},...t])}})},je=async({queryKey:o})=>{const[,e]=o;if(!e)return;const{data:t}=await k.get(`/rooms/room_type/get/${e}`);return t},ke=o=>{const e=[_.ROOM_TYPES,o];return ve(e,je)},qe=async t=>{var a=t,{id:o}=a,e=W(a,["id"]);const{data:u}=await k.put(`/rooms/room_type/update/${o}`,e);return u},Ue=()=>{const o=ee(),e=a=>{const u=o.getQueryData(_.ROOM_TYPES);!u||o.setQueryData(_.ROOM_TYPES,()=>u.map(i=>i.id!==a.id?i:{id:a.id,num_of_room:i.num_of_room,name:a.name,code:a.code}))},t=a=>{const u=o.getQueryData(_.ROOMS);!u||o.setQueryData(_.ROOMS,()=>u.map(i=>{const l=i.list_rooms.map(c=>R(T({},c),{room_type_code:a.code}));return R(T({},i),{list_rooms:l})}))};return Z(qe,{onSuccess:a=>{e(a),t(a)}})};const Be={key:0,class:"wrapper"},De={class:"container"},Ye={key:1,class:"wrapper"},$e={class:"container"},Le={class:"q-mt-md row justify-end q-gutter-md"},Ne=oe({props:{roomTypeId:{type:[String,Number],required:!0}},setup(o){const e=o,{notifySaveSuccess:t,notifySaveFailed:a}=Oe(),{data:u,isLoading:i}=Ee(),{data:l,isLoading:c}=ke(e.roomTypeId==="new"?0:+e.roomTypeId),M=Fe(),w=Ue(),q=j(()=>i.value||c.value),me=Ce(b.object({capacity_adult:b.number().int().min(1).max(10),capacity_child:b.number().int().min(0).max(10),num_of_bed:b.number().int().min(1).max(10),name:b.string().max(50).nonempty().refine(d=>{var n;return!((n=u.value)==null?void 0:n.filter(s=>{var p;return s.id!==((p=l.value)==null?void 0:p.id)}).some(s=>s.name===d))}),code:b.string().max(10).nonempty().refine(d=>{var n;return!((n=u.value)==null?void 0:n.filter(s=>{var p;return s.id!==((p=l.value)==null?void 0:p.id)}).some(s=>s.code===d))})})),{t:y}=ue(),ie=j(()=>{var d,n,s,p,L,N,P,A,H,K;return{capacity_adult:(n=(d=l.value)==null?void 0:d.capacity_adult)!=null?n:2,capacity_child:(p=(s=l.value)==null?void 0:s.capacity_child)!=null?p:0,num_of_bed:(N=(L=l.value)==null?void 0:L.num_of_bed)!=null?N:1,name:(A=(P=l.value)==null?void 0:P.name)!=null?A:"",code:(K=(H=l.value)==null?void 0:H.code)!=null?K:""}}),{handleSubmit:de}=we({validationSchema:me,initialValues:ie}),{value:x,errorMessage:U}=Q("capacity_adult"),{value:O,errorMessage:B}=Q("capacity_child"),{value:E,errorMessage:D}=Q("num_of_bed"),{value:I,errorMessage:Y}=Q("name"),{value:F,errorMessage:$}=Q("code"),ce=de(d=>{if(e.roomTypeId==="new"){M.mutate(d,{onSuccess:()=>{t()},onError:()=>{a()}});return}!l.value||w.mutate(R(T({},d),{id:e.roomTypeId,is_active:l.value.is_active}),{onSuccess:()=>{t()},onError:()=>{a()}})});return(d,n)=>(f(),re(xe,{onSubmit:r(ce)},{default:v(()=>[r(q)?(f(),h("div",Be,[(f(),h(te,null,ae(2,s=>m(le,{key:s,type:"QInput"})),64)),C("div",De,[(f(),h(te,null,ae(3,s=>m(le,{key:s,class:"col",type:"QInput"})),64))])])):(f(),h("div",Ye,[m(V,{modelValue:r(F),"onUpdate:modelValue":n[0]||(n[0]=s=>g(F)?F.value=s:null),label:r(y)("room_type_code"),"error-message":r($),error:!!r($)},null,8,["modelValue","label","error-message","error"]),m(V,{modelValue:r(I),"onUpdate:modelValue":n[1]||(n[1]=s=>g(I)?I.value=s:null),label:r(y)("room_type_name"),"error-message":r(Y),error:!!r(Y)},null,8,["modelValue","label","error-message","error"]),C("div",$e,[m(V,{modelValue:r(E),"onUpdate:modelValue":n[2]||(n[2]=s=>g(E)?E.value=s:null),modelModifiers:{number:!0},label:r(y)("number_of_beds"),"error-message":r(D),error:!!r(D),class:"col",type:"number"},null,8,["modelValue","label","error-message","error"]),m(V,{modelValue:r(x),"onUpdate:modelValue":n[3]||(n[3]=s=>g(x)?x.value=s:null),modelModifiers:{number:!0},label:r(y)("number_of_adults"),"error-message":r(U),error:!!r(U),class:"col",type:"number"},null,8,["modelValue","label","error-message","error"]),m(V,{modelValue:r(O),"onUpdate:modelValue":n[4]||(n[4]=s=>g(O)?O.value=s:null),modelModifiers:{number:!0},label:r(y)("number_of_children"),"error-message":r(B),error:!!r(B),class:"col",type:"number"},null,8,["modelValue","label","error-message","error"])])])),C("div",Le,[ge(m(se,{label:r(y)("cancel"),flat:"",type:"button"},null,8,["label"]),[[Qe]]),m(se,{label:r(y)("save"),color:"orange-9",type:"submit",disable:r(q)},null,8,["label","disable"])])]),_:1},8,["onSubmit"]))}});var Pe=he(Ne,[["__scopeId","data-v-ae84c5da"]]);const Ae={class:"text-h6"},oo=oe({setup(o){const e=Ve(),t=Me(),{t:a}=ue(),u=Se(!1),i=j(()=>{const{roomTypeId:c}=t.params;return Array.isArray(c)?null:c==="new"?"new":typeof+c=="number"?+c:null});Te(()=>u.value=!0);const l=()=>{e.replace({path:"/settings/room-settings",query:t.query})};return(c,M)=>r(i)?(f(),re(be,{key:0,modelValue:u.value,"onUpdate:modelValue":M[0]||(M[0]=w=>u.value=w),onHide:l},{default:v(()=>[m(fe,{style:{width:"700px","max-width":"80vw"}},{default:v(()=>[m(X,null,{default:v(()=>[C("div",Ae,ne(r(i)==="new"?r(a)("new_room_type"):r(a)("edit_room_type"))+" "+ne(r(e).options.history.state.code),1)]),_:1}),m(X,{class:"q-pt-none"},{default:v(()=>[m(Pe,{"room-type-id":r(i)},null,8,["room-type-id"])]),_:1})]),_:1})]),_:1},8,["modelValue"])):Re("v-if",!0)}});export{oo as default};
