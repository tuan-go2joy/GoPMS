import{f as I,r as N,i as H,v as R,W as M,N as P,o as L,l as d,g as u,j as h,y as l,w as k,B as s,n as v,x as t,h as S,z as U,F as z,A as B,C as y}from"./vendor.6c1f170c.js";import{a as D,_ as A}from"./index.a42a404f.js";import{u as E}from"./useFormat.532d12a0.js";async function ye(e){return await D.get("/myBooking/getMyBookingList",{params:e})}async function O(e){return await D.post("/myBooking/cancelBooking",e)}async function W(e){return D.defaults.headers.common.Localization=e,await D.get("/myBooking/getReasonCancelList")}async function fe(e){return await D.get("/myBooking/getHotelSearchList",{params:e})}async function Y(e){return await D.get("/myBooking/getTypePopupCancel",{params:e})}const $="_form__button_1p6tg_8";var G={"dialog-header":"_dialog-header_1p6tg_1",form__button:$};const J=6,K=I({name:"CancelDialog",props:{visible:{type:Boolean,default:!1}},emits:["update:modelValue","close","cancelSuccess"],setup(e,{emit:i}){const g=N(null),o=H("emitter"),{t:f,locale:w}=R(),n={reason_cancel_sn:[{required:!0,message:f("page.myBooking.requireReasonSelect"),trigger:"change"}],reason_cancel:[{required:!0,message:f("page.myBooking.requireReasonInput"),trigger:"change"}]},r=M({loading:!1,loadingCancelBooking:!1,showReasonMessage:!1}),m=M({sn:"",reason_cancel_sn:null,reason_cancel:""}),b=N([]),C=P({get(){return e.visible},set(_){i("update:modelValue",_)}});L(()=>{c(),o.on("changeLang",async()=>{c()})});const a=async _=>{await c(),m.sn=_.sn},p=()=>{r.showReasonMessage=m.reason_cancel_sn===J},c=async()=>{r.loading=!0;try{const _=localStorage.getItem("lang")||"en",{data:V}=await W(_);b.value=V.data}catch{return!1}finally{r.loading=!1}},T=_=>{g.value.resetFields(),i("close",_)};return{formRef:g,t:f,locale:w,ui:r,rules:n,reasons:b,paramsCancel:m,dialogVisible:C,setupDialog:a,closeDialog:T,onSendRequest:()=>{g.value.validate(async _=>{if(!_)return!1;try{r.loadingCancelBooking=!0;const{data:V}=await O(m);V.data&&(i("cancelSuccess"),T())}catch{return!1}finally{r.loadingCancelBooking=!1}})},changeReason:p}}});function Q(e,i,g,o,f,w){const n=d("ElOption"),r=d("el-select"),m=d("el-form-item"),b=d("el-input"),C=d("el-button"),a=d("el-form"),p=d("el-dialog");return u(),h(p,{modelValue:e.dialogVisible,"onUpdate:modelValue":i[2]||(i[2]=c=>e.dialogVisible=c),width:"600px",onClose:e.closeDialog},{default:l(()=>[k("div",{class:v(e.$style["dialog-header"])},s(e.t("page.myBooking.cancelRequest")),3),t(a,{ref:"formRef",model:e.paramsCancel,"label-position":"top",rules:e.rules,class:v(e.$style.form),"hide-required-asterisk":""},{default:l(()=>[t(m,{label:e.t("page.myBooking.reasonForCancel"),prop:"reason_cancel_sn"},{default:l(()=>[t(r,{modelValue:e.paramsCancel.reason_cancel_sn,"onUpdate:modelValue":i[0]||(i[0]=c=>e.paramsCancel.reason_cancel_sn=c),placeholder:e.t("page.myBooking.reasonForCancel"),loading:e.ui.loading,style:{width:"100%"},onChange:e.changeReason},{default:l(()=>[(u(!0),S(z,null,U(e.reasons,(c,T)=>(u(),h(n,{key:T,value:c.sn,label:c.name},null,8,["value","label"]))),128))]),_:1},8,["modelValue","placeholder","loading","onChange"])]),_:1},8,["label"]),e.ui.showReasonMessage?(u(),h(m,{key:0,prop:e.ui.showReasonMessage?"reason_cancel":""},{default:l(()=>[t(b,{modelValue:e.paramsCancel.reason_cancel,"onUpdate:modelValue":i[1]||(i[1]=c=>e.paramsCancel.reason_cancel=c),placeholder:e.t("page.myBooking.enterYourReason")},null,8,["modelValue","placeholder"])]),_:1},8,["prop"])):B("v-if",!0),t(m,null,{default:l(()=>[t(C,{type:"warning",class:v(e.$style.form__button),loading:e.ui.loadingCancelBooking,onClick:e.onSendRequest},{default:l(()=>[y(s(e.t("button.sendRequest")),1)]),_:1},8,["class","loading","onClick"])]),_:1})]),_:1},8,["model","rules","class"])]),_:1},8,["modelValue","onClose"])}const q={};q.$style=G;var _e=A(K,[["render",Q],["__cssModules",q]]),X={"table-booking":"_table-booking_1w4ym_1"};const Z={name:"TableBookings",props:{data:{type:Array,default:()=>[]}},setup(e,{emit:i}){const g=M({loadingTypePopup:!1}),{t:o,locale:f}=R(),{formatDate:w,formatMoney:n,formatTime:r}=E();return{ui:g,t:o,locale:f,formatDate:w,formatMoney:n,formatTime:r,setBookingStatus:p=>{switch(p){case 0:return o("page.myBooking.all");case 1:return o("page.myBooking.confirmed");case 2:return o("page.myBooking.checkIn");case 3:return o("page.myBooking.cancel");case 4:return o("page.myBooking.noShow");case 5:return o("page.myBooking.paymentFail");default:return""}},setBookingType:p=>{switch(p){case 1:return o("page.myBooking.hourly");case 2:return o("page.myBooking.overnight");case 3:return o("page.myBooking.daily");default:return""}},showCancelDialog:async p=>{try{g.loadingTypePopup=!0;const{data:c}=await Y({sn:p});i("showCancelDialog",{sn:p,typePopup:c.data.typePopupCancel})}catch{return!1}finally{g.loadingTypePopup=!1}},showSuccessfullyDialog:()=>{i("showSuccessfullyDialog")}}}},x={key:0},ee={key:0},oe={key:1},ae={key:0},ne={key:1},le={class:"text-danger"};function te(e,i,g,o,f,w){const n=d("el-table-column"),r=d("router-link"),m=d("el-tooltip"),b=d("el-button"),C=d("el-table");return u(),h(C,{data:g.data,class:v(e.$style["table-booking"])},{default:l(()=>[t(n,{type:"index",label:"#","min-width":"2"}),t(n,{label:o.t("page.myBooking.hotelName"),"min-width":"10"},{default:l(a=>[t(r,{to:{name:"HotelDetails",params:{sn:a.row.hotelSn}}},{default:l(()=>[y(s(a.row.hotelName),1)]),_:2},1032,["to"])]),_:1},8,["label"]),t(n,{label:o.t("page.myBooking.bookingNo"),"min-width":"8"},{default:l(a=>[t(m,{content:`Partner ID: ${a.row.partnerUserBookingId}`,placement:"right",effect:"light"},{default:l(()=>[t(r,{to:{name:"BookingDetails",params:{sn:a.row.sn}}},{default:l(()=>[y(s(a.row.bookingNo),1)]),_:2},1032,["to"])]),_:2},1032,["content"]),k("p",null,s(o.formatDate(a.row.createTime)),1)]),_:1},8,["label"]),t(n,{prop:"mobile",label:o.t("page.myBooking.userInfo"),"class-name":"break-all","min-width":"6"},null,8,["label"]),t(n,{prop:"roomTypeName",label:o.t("page.myBooking.roomType"),"min-width":"8"},null,8,["label"]),t(n,{prop:"bookingType",label:o.t("page.myBooking.bookingType"),"min-width":"6"},{default:l(a=>[k("p",null,s(o.setBookingType(a.row.type)),1)]),_:1},8,["label"]),t(n,{label:o.t("page.myBooking.stayAtHotelTime"),"min-width":"6"},{default:l(a=>[k("p",null,s(a.row.checkInDatePlan),1),a.row.type===1?(u(),S("p",x,[y(s(o.formatTime(a.row.startTime))+" ",1),a.row.endTime?(u(),S("span",ee,"~ "+s(o.formatTime(a.row.endTime)),1)):B("v-if",!0)])):a.row.type===3?(u(),S("p",oe,s(a.row.endDate),1)):B("v-if",!0)]),_:1},8,["label"]),t(n,{label:o.t("page.myBooking.bookingStatus"),"min-width":"6"},{default:l(a=>[a.row.bookingStatus===1||a.row.bookingStatus===2?(u(),S("div",ae,s(o.t("page.myBooking.confirmed")),1)):a.row.bookingStatus===3?(u(),S("div",ne,[y(s(o.t("page.myBooking.cancel"))+": ",1),k("p",null,s(o.formatDate(a.row.checkInTime)),1)])):B("v-if",!0)]),_:1},8,["label"]),t(n,{label:o.t("page.myBooking.roomAmount"),"class-name":"break-all","min-width":"6"},{default:l(a=>[y(s(o.formatMoney(a.row.roomTypeAmount)),1)]),_:1},8,["label"]),t(n,{label:o.t("page.myBooking.totalAmount"),"class-name":"break-all","min-width":"6"},{default:l(a=>[y(s(o.formatMoney(a.row.totalAmount)),1)]),_:1},8,["label"]),t(n,{prop:"discount",label:o.t("page.myBooking.discount"),"class-name":"break-all","min-width":"6"},{default:l(a=>[y(s(o.formatMoney(a.row.totalHotelDiscount)),1)]),_:1},8,["label"]),t(n,{prop:"userPay",label:o.t("page.myBooking.userPay"),"class-name":"break-all","min-width":"6"},{default:l(a=>[y(s(o.formatMoney(a.row.amountFromUser)),1)]),_:1},8,["label"]),t(n,{label:o.t("page.myBooking.paidInAdvance"),"class-name":"break-all","min-width":"6"},{default:l(a=>[k("p",le,s(o.formatMoney(a.row.prepayAmount)),1),B(` <div v-if="scope.row.refunded > 0">
          
        </div>
        <div v-else-if="scope.row.refunded === 0">
          <p v-if="scope.row.prepayAmount > 0">
            {{ formatMoney(scope.row.prepayAmount) }}
          </p>
        </div> `)]),_:1},8,["label"]),t(n,{label:o.t("page.myBooking.operations"),"class-name":"operations",align:"center","min-width":"12"},{default:l(a=>[(a.row.bookingStatus===1||a.row.bookingStatus===2)&&a.row.portalReasonCancellationSn?(u(),h(b,{key:0,type:"warning",plain:"",size:"small",onClick:o.showSuccessfullyDialog},{default:l(()=>[y(s(o.t("button.waitingResponse")),1)]),_:1},8,["onClick"])):B("v-if",!0),(a.row.bookingStatus===1||a.row.bookingStatus===2)&&!a.row.portalReasonCancellationSn?(u(),h(b,{key:1,type:"danger",plain:"",size:"small",onClick:p=>o.showCancelDialog(a.row.sn)},{default:l(()=>[y(s(o.t("button.cancel")),1)]),_:2},1032,["onClick"])):B("v-if",!0)]),_:1},8,["label"])]),_:1},8,["data","class"])}const F={};F.$style=X;var ke=A(Z,[["render",te],["__cssModules",F]]);const se="_dialog_j7s4f_1",ie="_dialog__header_j7s4f_4";var re={dialog:se,dialog__header:ie};const ce=I({name:"SuccessfullyDialog",props:{visible:{type:Boolean,default:!1}},emits:["update:modelValue","close"],setup(e,{emit:i}){const{t:g,locale:o}=R(),f=P({get(){return e.visible},set(n){i("update:modelValue",n)}});return{t:g,locale:o,dialogVisible:f,closeDialog:n=>{i("close",n)}}}});function ge(e,i,g,o,f,w){const n=d("el-dialog");return u(),h(n,{modelValue:e.dialogVisible,"onUpdate:modelValue":i[0]||(i[0]=r=>e.dialogVisible=r),width:"600px",onClose:e.closeDialog},{default:l(()=>[k("div",{class:v(e.$style.dialog)},[k("div",{class:v(e.$style.dialog__header)},s(e.t("page.myBooking.successSubmit")),3),k("p",null,s(e.t("page.myBooking.cancellationHasBeenSent")),1)],2)]),_:1},8,["modelValue","onClose"])}const j={};j.$style=re;var be=A(ce,[["render",ge],["__cssModules",j]]);export{_e as C,be as S,ke as T,ye as a,O as c,fe as f};
