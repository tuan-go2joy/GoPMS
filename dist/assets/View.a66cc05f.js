import{f as F,v as j,H as U,W as H,r as V,N as I,$ as P,o as A,l as d,a0 as q,g as f,j as w,y as l,n as B,x as n,h as k,z as L,F as z,a1 as E,C as N,B as o,w as s,A as T}from"./vendor.6c1f170c.js";import{a as Y,_ as W}from"./index.a42a404f.js";import{d as G}from"./debounce.5c85f6b1.js";import{u as J}from"./useFormat.532d12a0.js";async function K(e){return await Y.get("/revenue/getRevenueDetail",{params:e})}async function O(e){return await Y.get("/myBooking/getHotelSearchList",{params:e})}var Q={"hotel-list":"_hotel-list_1mg3r_1"};const X=F({name:"Revenue",setup(){const{formatDate:e,formatMoney:i,formatTime:C}=J(),{t:c,locale:D}=j(),h=U(),m=H({isLoadingRevenue:!1,isLoadingHotel:!1,total:0,type:[{label:"page.revenue.check_in_date",value:1},{label:"page.revenue.booking_time",value:2}]}),v=V([]),g=V([]),u=H({hotelSn:Number(h.params.sn),type:1,page:1,limit:10,startDate:e(h.query.startDate,!1),endDate:e(h.query.endDate,!1)}),y=I({get:()=>[u.startDate,u.endDate],set:t=>{u.startDate=t[0],u.endDate=t[1]}});P(()=>y.value,t=>{r()}),A(()=>{r(),b({limit:10,hotelSn:h.params.sn})});const r=async()=>{var t;m.isLoadingRevenue=!0,g.value=[];try{const{data:p}=await K(u);((t=p.data)==null?void 0:t.revenueList.length)>0&&(g.value=p.data.revenueList,g.value.unshift(p.data.statistics)),m.total=p.data.meta.total}catch{return!1}finally{m.isLoadingRevenue=!1}},_=G(function(t){b({limit:10,keyword:t})},500),b=async t=>{m.isLoadingHotel=!0;try{const{data:p}=await O(t);v.value=p.data}catch{return!1}finally{m.isLoadingHotel=!1}};return{t:c,locale:D,ui:m,dataRevenue:g,filter:u,listSuggestionsHotels:v,dateRange:y,formatMoney:i,formatTime:C,indexMethod:t=>t==0?"":t,getBookingType:t=>{switch(t){case 1:return c("page.myBooking.hourly")+" :";case 2:return c("page.myBooking.overnight")+" :";case 3:return c("page.myBooking.daily")+" :"}},searchSuggestionsHotels:_,getRevenueData:r,handleSizeChange:async t=>{u.limit=t,r()},handleCurrentChange:async t=>{u.page=t,r()}}}}),Z={key:0},x={key:0};function ee(e,i,C,c,D,h){const m=d("el-option"),v=d("el-select"),g=d("el-form-item"),u=d("el-date-picker"),y=d("el-form"),r=d("el-table-column"),_=d("router-link"),b=d("el-table"),S=d("el-pagination"),M=d("portal-section"),R=q("loading");return f(),w(M,{class:B(e.$style.revenue)},{header:l(()=>[n(y,{inline:!0,model:e.filter,class:"demo-form-inline"},{default:l(()=>[n(g,null,{default:l(()=>[n(v,{modelValue:e.filter.hotelSn,"onUpdate:modelValue":i[0]||(i[0]=a=>e.filter.hotelSn=a),loading:e.ui.isLoadingHotel,placeholder:e.t("page.myBooking.hotelName"),remote:"",filterable:"","remote-method":e.searchSuggestionsHotels,"prefix-icon":"el-icon-search",clearable:"",onChange:e.getRevenueData},{default:l(()=>[(f(!0),k(z,null,L(e.listSuggestionsHotels,(a,t)=>(f(),w(m,{key:t,label:a.name,value:a.sn,class:B(e.$style["hotel-list"])},{default:l(()=>[s("p",null,o(a.name),1),s("p",null,o(a.address),1)]),_:2},1032,["label","value","class"]))),128))]),_:1},8,["modelValue","loading","placeholder","remote-method","onChange"])]),_:1}),n(g,null,{default:l(()=>[n(u,{modelValue:e.dateRange,"onUpdate:modelValue":i[1]||(i[1]=a=>e.dateRange=a),type:"daterange","range-separator":"-",format:"YYYY/MM/DD","value-format":"YYYY-MM-DD",clearable:!1},null,8,["modelValue"])]),_:1}),n(g,null,{default:l(()=>[n(v,{modelValue:e.filter.type,"onUpdate:modelValue":i[2]||(i[2]=a=>e.filter.type=a),onChange:e.getRevenueData},{default:l(()=>[(f(!0),k(z,null,L(e.ui.type,(a,t)=>(f(),w(m,{key:t,value:a.value,label:e.t(a.label)},null,8,["value","label"]))),128))]),_:1},8,["modelValue","onChange"])]),_:1})]),_:1},8,["model"])]),footer:l(()=>[n(S,{onSizeChange:e.handleSizeChange,onCurrentChange:e.handleCurrentChange,currentPage:e.filter.page,"onUpdate:currentPage":i[3]||(i[3]=a=>e.filter.page=a),"page-sizes":[10,20,30,40,50],"page-size":e.filter.limit,layout:"total, sizes, prev, pager, next, jumper",total:e.ui.total},null,8,["onSizeChange","onCurrentChange","currentPage","page-size","total"])]),default:l(()=>[E((f(),w(b,{data:e.dataRevenue},{default:l(()=>[n(r,{"class-name":"break-all",label:"#",type:"index","min-width":"2",index:e.indexMethod},null,8,["index"]),n(r,{"class-name":"break-all",label:e.t("page.revenue.hotel_name"),"min-width":90},{default:l(a=>[n(_,{to:{name:"HotelDetails",params:{sn:a.row.hotelSn?a.row.hotelSn:" "}}},{default:l(()=>[N(o(a.row.hotelName),1)]),_:2},1032,["to"]),s("p",null,o(a.row.hotelCode),1)]),_:1},8,["label"]),n(r,{"class-name":"break-all",label:e.t("page.revenue.booking_info"),"min-width":90},{default:l(a=>[s("p",null,o(a.row.bookingNo),1),s("p",null,o(a.row.mobile),1),s("p",null,o(a.row.roomTypeName),1),s("p",null,[N(o(e.getBookingType(a.row.type))+" "+o(a.row.checkInDatePlan)+" ",1),a.row.type===3?(f(),k("span",Z,o(a.row.endDate),1)):T("v-if",!0)]),a.row.type===1?(f(),k("p",x,o(e.formatTime(a.row.startTime))+" ~ "+o(e.formatTime(a.row.endTime)),1)):T("v-if",!0)]),_:1},8,["label"]),n(r,{"class-name":"break-all",label:e.t("page.revenue.extra_fee"),"min-width":90},{default:l(a=>[s("p",null,o(e.formatMoney(a.row.extraFee)),1)]),_:1},8,["label"]),n(r,{"class-name":"break-all",label:e.t("page.revenue.total_amount"),"min-width":90},{default:l(a=>[s("p",null,o(e.formatMoney(a.row.totalAmount)),1)]),_:1},8,["label"]),n(r,{"class-name":"break-all",label:e.t("page.revenue.discount"),"min-width":90},{default:l(a=>[s("p",null,o(e.formatMoney(a.row.totalHotelDiscount)),1)]),_:1},8,["label"]),n(r,{"class-name":"break-all",label:e.t("page.revenue.user_pay"),"min-width":90},{default:l(a=>[s("p",null,o(e.formatMoney(a.row.amountFromUser)),1)]),_:1},8,["label"]),n(r,{"class-name":"break-all",label:e.t("page.revenue.paid_in_advance"),"min-width":90},{default:l(a=>[s("p",null,o(e.formatMoney(a.row.paidInAdvance)),1)]),_:1},8,["label"])]),_:1},8,["data"])),[[R,e.ui.isLoadingRevenue]])]),_:1},8,["class"])}const $={};$.$style=Q;var oe=W(X,[["render",ee],["__cssModules",$]]);export{oe as default};
