import{C as I,S as O,T as U,f as x,a as J,c as L}from"./successfully-dialog.100df485.js";import{r as y,v as G,W as w,N as K,$ as W,o as q,l as i,a0 as A,a1 as Q,g as d,j as k,y as g,n as u,a5 as X,E as Y,w as j,x as r,h as M,z,F,C as H,B as N}from"./vendor.6c1f170c.js";import{d as Z}from"./debounce.5c85f6b1.js";import{u as $}from"./useFormat.532d12a0.js";import{_ as ee}from"./index.a42a404f.js";const oe="_booking__header_1szet_1",ae="_booking__option_1szet_11";var le={booking__header:oe,booking__option:ae,"booking__header--item":"_booking__header--item_1szet_22"};const R=new Date,ne={name:"MyBooking",components:{CancelDialog:I,SuccessfullyDialog:O,TableBookings:U},setup(){const{formatDate:s}=$(),l=y(null),D=y(null),{t:e,locale:P}=G(),c=w({loading:!1,loadingHotels:!1,cancelDialogVisible:!1,successfullyDialogVisible:!1,bookingStatus:[{label:"allStatus",value:0},{label:"confirmed",value:1},{label:"cancel",value:3}],types:[{label:"bookingTime",value:2},{label:"checkInDate",value:1}]}),b=y([]),f=y({}),S=y(1),h=y([]),m=JSON.parse(sessionStorage.getItem("filterMybooking"));m&&(m.hotelSn="");const t=m?w(m):w({startDate:s(R,!1),endDate:s(R,!1),hotelSn:"",type:1,bookingStatus:0,limit:10,page:1}),_=K({get:()=>[t.startDate,t.endDate],set:a=>{t.startDate=a[0],t.endDate=a[1]}});W(()=>_.value,a=>{sessionStorage.setItem("filterMybooking",JSON.stringify(t)),n()}),q(()=>{n()});const C=()=>{sessionStorage.setItem("filterMybooking",JSON.stringify(t)),n()},v=Z(function(a){V({limit:10,keyword:a})},500),B=()=>{c.successfullyDialogVisible=!0,n()},V=async a=>{c.loadingHotels=!0;try{const{data:p}=await x(a);b.value=p.data}catch{return!1}finally{c.loadingHotels=!1}},o=a=>{const p=e("page.myBooking.cancelMessage");X.confirm(`${p}?`,"",{confirmButtonText:"OK",cancelButtonText:"Cancel",type:"info"}).then(async()=>{try{const{data:T}=await L({sn:a});T.data&&Y({type:"success",message:e("message.updateSuccess")}),n()}catch{return!1}}).catch(()=>{Y({type:"info",message:"Delete canceled"})})},n=async()=>{c.loading=!0;try{const{data:a}=await J(t);h.value=a.data.myBookingList,f.value=a.data.meta}catch{return!1}finally{c.loading=!1}};return{currentPage:S,pagination:f,cancelDialogRef:D,successfullyDialogRef:l,myBookings:h,listSuggestionsHotels:b,ui:c,filter:t,t:e,locale:P,dateRange:_,handleSizeChange:a=>{t.limit=Number(a),n()},handleCurrentChange:a=>{t.page=Number(a),n()},searchSuggestionsHotels:v,onFetchMyBookings:n,showSuccessfullyDialog:()=>{c.successfullyDialogVisible=!0},showCancelDialog:a=>{a.typePopup===2?(D.value.setupDialog(a),c.cancelDialogVisible=!0):a.typePopup===1&&o(a.sn)},handleCancelSuccess:B,openCancelConfirm:o,changeFilter:C}}},se=j("br",null,null,-1);function te(s,l,D,e,P,c){const b=i("el-option"),f=i("el-select"),S=i("el-date-picker"),h=i("ElOption"),m=i("el-button"),t=i("el-pagination"),_=i("TableBookings"),C=i("CancelDialog"),v=i("SuccessfullyDialog"),B=i("portal-section"),V=A("loading");return Q((d(),k(B,{class:u(s.$style.booking)},{header:g(()=>[j("div",{class:u(s.$style.booking__header)},[r(f,{modelValue:e.filter.hotelSn,"onUpdate:modelValue":l[0]||(l[0]=o=>e.filter.hotelSn=o),loading:e.ui.loadingHotels,placeholder:e.t("page.myBooking.hotelName"),remote:"",filterable:"","remote-method":e.searchSuggestionsHotels,"prefix-icon":"el-icon-search",clearable:"",class:u(s.$style["booking__header--item"]),onChange:e.onFetchMyBookings},{default:g(()=>[(d(!0),M(F,null,z(e.listSuggestionsHotels,(o,n)=>(d(),k(b,{key:n,label:o.name,value:o.sn,style:{"font-size":"13px",color:"#4a5d6e"},class:u(s.$style.booking__option)},{default:g(()=>[H(N(o.name)+" ",1),se,H(" "+N(o.address),1)]),_:2},1032,["label","value","class"]))),128))]),_:1},8,["modelValue","loading","placeholder","remote-method","class","onChange"]),r(S,{modelValue:e.dateRange,"onUpdate:modelValue":l[1]||(l[1]=o=>e.dateRange=o),type:"daterange","range-separator":"-","start-placeholder":e.t("page.myBooking.startDate"),"end-placeholder":e.t("page.myBooking.endDate"),format:"YYYY/MM/DD","value-format":"YYYY-MM-DD",clearable:!1,class:u(s.$style["booking__header--item"])},null,8,["modelValue","start-placeholder","end-placeholder","class"]),r(f,{modelValue:e.filter.type,"onUpdate:modelValue":l[2]||(l[2]=o=>e.filter.type=o),class:u(s.$style["booking__header--item"]),onChange:e.changeFilter},{default:g(()=>[(d(!0),M(F,null,z(e.ui.types,(o,n)=>(d(),k(h,{key:n,value:o.value,label:e.t(`page.myBooking.${o.label}`)},null,8,["value","label"]))),128))]),_:1},8,["modelValue","class","onChange"]),r(f,{modelValue:e.filter.bookingStatus,"onUpdate:modelValue":l[3]||(l[3]=o=>e.filter.bookingStatus=o),class:u(s.$style["booking__header--item"]),onChange:e.changeFilter},{default:g(()=>[(d(!0),M(F,null,z(e.ui.bookingStatus,(o,n)=>(d(),k(h,{key:n,value:o.value,label:e.t(`page.myBooking.${o.label}`)},null,8,["value","label"]))),128))]),_:1},8,["modelValue","class","onChange"]),r(m,{plain:"",icon:"el-icon-search",class:u(s.$style["booking__header--item"]),onClick:l[4]||(l[4]=o=>s.$router.push({name:"SearchBooking"}))},{default:g(()=>[H(N(e.t("page.myBooking.searchByID")),1)]),_:1},8,["class"])],2)]),footer:g(()=>[r(t,{currentPage:e.currentPage,"onUpdate:currentPage":l[5]||(l[5]=o=>e.currentPage=o),"page-sizes":[10,20,30,40,50],"page-size":e.pagination.perPage?e.pagination.perPage:10,layout:"total, sizes, prev, pager, next, jumper",total:e.pagination.total?e.pagination.total:0,onSizeChange:e.handleSizeChange,onCurrentChange:e.handleCurrentChange},null,8,["currentPage","page-size","total","onSizeChange","onCurrentChange"])]),default:g(()=>[r(_,{data:e.myBookings,onShowCancelDialog:e.showCancelDialog,onShowSuccessfullyDialog:e.showSuccessfullyDialog},null,8,["data","onShowCancelDialog","onShowSuccessfullyDialog"]),r(C,{ref:"cancelDialogRef",visible:e.ui.cancelDialogVisible,onClose:l[6]||(l[6]=o=>e.ui.cancelDialogVisible=!1),onCancelSuccess:e.handleCancelSuccess},null,8,["visible","onCancelSuccess"]),r(v,{ref:"successfullyDialogRef",visible:e.ui.successfullyDialogVisible,onClose:l[7]||(l[7]=o=>e.ui.successfullyDialogVisible=!1)},null,8,["visible"])]),_:1},8,["class"])),[[V,e.ui.loading]])}const E={};E.$style=le;var he=ee(ne,[["render",te],["__cssModules",E]]);export{he as default};
